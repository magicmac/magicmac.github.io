<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="alternate icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.16.6"><title>Detecting analysts before installing the malware (IE)</title><meta name="description" content><link rel="canonical" href="https://www.brokenbrowser.com/blog/detecting-apps-mimetype-malware/"><meta property="og:title" content="Detecting analysts before installing the malware (IE)"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://www.brokenbrowser.com/blog/detecting-apps-mimetype-malware/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Detecting analysts before installing the malware (IE)"><meta name="twitter:description" content><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><link rel="stylesheet" href="/_astro/_slug_.D8CnJWvD.css"></head> <body> <div class="container center"> <header class="header"> <div class="header__inner"> <div class="header__logo"> <a href="/"> <div class="logo">
MagicMac Labs
</div> </a> </div> <ul class="menu menu--mobile"> <li class="menu__trigger">Menu ▾</li> <li> <ul class="menu__dropdown"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </li> </ul> </div> <nav class="navigation-menu"> <ul class="navigation-menu__inner menu--desktop"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </nav> </header> <main class="content">  <article> <h1 class="post-title">Detecting analysts before installing the malware (IE)</h1> <div class="post-meta"> <time> <time datetime="2016-09-19T00:00:00.000Z"> 2016-09-19 </time> </time> <span class="post-category"> :: browser-workshop</span>  </div>  <div class="post-content">  <p>With the help of a beautiful piece of code, malware authors can detect installed applications straight from within the browser and serve the bad bits only to unsavvy users. In other words, attackers target regular users by detecting specific analysts applications (like <a href="http://www.telerik.com/fiddler">Fiddler</a>) and serving their harmful program to users that do not have those apps installed. Essentially, their goal is to keep their malware under the radars for a longer period of time.</p>
<p>Today we are going find a variation for CVE-2016-3351 that Microsoft patched last Tuesday, but before getting started, let me tell you that I couldn’t even begin this without the continued help of Jérôme Segura from MalwareBytes. Also, later on the issue I received help from <a href="https://twitter.com/kafeine">Kafeine</a>, <a href="https://twitter.com/brooks_li">Brooks Li</a>, and <a href="https://twitter.com/Jspchc">Joseph C Chen</a> either directly or out of their <a href="https://www.proofpoint.com/us/threat-insight/post/massive-adgholas-malvertising-campaigns-use-steganography-and-file-whitelisting-to-hide-in-plain-sight">impressive research on AdGholas</a>. Finally, I’d like to thank <a href="https://twitter.com/ericlaw">Eric Lawrence</a> and <a href="https://twitter.com/randomdross">David Ross</a> because without their constant help and support, blogging for me wouldn’t be possible.</p>
<p>Until last week, I have no idea of the details on the technique that follows. I knew like everyone else that <a href="https://www.proofpoint.com/us/threat-insight/post/massive-adgholas-malvertising-campaigns-use-steganography-and-file-whitelisting-to-hide-in-plain-sight">AdGholas was evading analysts</a> but I had no idea how, and no free time to research about it. However, I was still curious but Brooks Li gently told me that he couldn’t share the PoC until Microsoft released the patch. So, I simply forgot about this until last Tuesday, when I saw that my PC was updating. Ohh!! The mimeType bug! So I requested the PoC from Brooks and he told me that they have published the solution, <a href="https://www.proofpoint.com/us/threat-insight/post/Microsoft-Patches-Zero-Day-Exploited-By-AdGholas-GooNky-Malvertising">right here</a>. The article was impressive, but what caught my attention was the image below (yellow is mine).</p>
<p><img src="/images/2016/09/01-proofpoint-pic.png" alt="Elegant Code"></p>
<p>This is beautiful! How simple and elegant! Let’s convert it into something easier for our eyes:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">anchor </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> document</span><span style="color:var(--astro-code-token-function)">.createElement</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"A"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">anchor</span><span style="color:var(--astro-code-foreground)">.href </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)"> ".saz"</span><span style="color:var(--astro-code-foreground)">;</span></span>
<span class="line"><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-constant)">anchor</span><span style="color:var(--astro-code-foreground)">.mimeType);</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// returns Fiddler Session Archive</span></span></code></pre>
<p><img src="/images/2016/09/02-proof-fiddler.png" alt="Fiddler Archive"></p>
<p>Impressive! This returns <em>Fiddler Session Archive,</em> so attackers will quickly know if the user has Fiddler installed! Of course this can be done with other extensions and if you are curious, open the registry and navigate to <em>Computer\HKEY_CLASSES_ROOT</em>. There they are.</p>
<p>I was really amazed by the simplicity of the code, extremely beautiful even being malware, so I created a simple function based on it for easier testing. Of course that beauty will stop working after updating our Windows, but who will deny its elegance anyway? Five minutes later my PC was updated and I was excited to see the same code failing after the patch. Predictably, it failed. It now returns “undefined” when we retrieve mimeType property of an anchor element.</p>
<p>Just as a quick preview of what’s coming, take a look at the before and after patch pictures. If it were the ad of a weight loss product we would be impressed by the change: the code has really been reduced! We don’t need to analyze anything at this point, just watch how the code was brutally trimmed. I prefer the elegance of the malware authors, even if malware. And by the way, attackers won’t get discouraged by this trim, they will instead try to find an alternative.</p>
<p><img src="/images/2016/09/before-after-1.png" alt=""></p>
<h3 id="bug-patched-finding-an-alternative">Bug patched: Finding an Alternative</h3>
<p>So the patch is brutal but ideas start flowing. Why don’t we find an alternative route (aka variation) like real attackers do? It might be possible and worth a few minutes. So we need to get the unpatched code (from mshtml.dll in this case) and find what’s the binary function that gets hit when we access the anchor mimeType. Then, we need to find a way to call that same code using a different path.</p>
<p>The flow below shows what we guess <strong>before</strong> even disassembling mshtml. We know for sure that the yellow path exists, but we want to know if there are alternatives (red) to it. How can we do that? First, we should find the exact binary code that retrieves the mimeType, and then, uncover other references to it. The red path is a speculation, something that could or could not be there. But we will give it a try and get the answer pretty quick.</p>
<p>There is a path from the JavaScript anchor.mimeType to a binary function (compiled code) that retrieves the mimeType. Our goal is to find the binary code that retrieves the mimeType and uncover every reference to it. The red paths show references that we suspect might exist, and even if this is just a guess, it’s worth our time because it can be done in a couple of minutes.</p>
<p><img src="/images/2016/09/01-findourway.png" alt="Path to mimeType"></p>
<p>We will be using IDA Free for this task but there are many tools to achieve the same thing. In fact, once we get familiar with IE/Edge function names, we will go faster with a live debugger like WinDBG or even a quick disassembler like Hiew (with symbols). But today we will assume that IE is a strange object for us and we don’t know anything about it.</p>
<blockquote>
<p>Note: I will be posting soon how to setup IDA Free with public symbols so you can do exactly as we do here. But in the meantime I pasted <a href="http://pastebin.com/U3GqV3SV">plain-text instructions here</a> so you can get started!</p>
</blockquote>
<h3 id="finding-the-interestingcode">Finding the Interesting Code</h3>
<p>Let’s drop in IDA the binary that makes Internet Explorer tick: mshtml.dll. If you are not familiar with disassemblers, just follow as much as you can. This will be pretty basic and we can safely forget about opcodes today. Ready for the adventure? Remember: no Assembler required, just a bit of mind-stretching on ourselves.
First Goal: find the binary code that reveals the mimeType information.</p>
<p>We know that in JavaScript, anchor.mimeType retrieves the information that we want, so let’s go straight to the Strings Tab in IDA and search for “mimeType”. We want to see what’s the code that references it. The first two matches clearly have nothing to do with our goal: MSMimeTypesCollections, MSMimeTypesCollectionsPrototype. The third one is <strong>M</strong>imeType but we want one that starts with a lowercase m. The next two are MimeTypeArray are MimeTypeArrayPrototype which again are not what we need. Next one seems to be what we are searching for! This is the first real match of “mimeType”.</p>
<p><img src="/images/2016/09/05-mimeType-string-found.png" alt="mimeType String Found"></p>
<p>Double clicking on that string takes us to the binary code tab (IDA-ViewA) which includes data references.</p>
<p><img src="/images/2016/09/06-reference-01.png" alt="IDA Code View"></p>
<p>IDA labels everything it can to help us with the analysis. In this case the “mimeType” string pointer was named aMimetype_2 as shown above (1). At the right (2) we can see the code that uses this string, but in order to see the complete list we should click on the label aMimeType_2 and press the “X” so a popUp will open with every line of code referencing this string. How convenient! (We know there are more references because of the three dots (3) at the right).</p>
<p>Now check out the popUp below. We have three references and the middle one seems to be the one that we need. Don’t you think so? We want to find first what’s the binary code that is hit when we access anchor.mimeType and the function names below, make sense to me.</p>
<p><img src="/images/2016/09/07-reference-02.png" alt="IDA References popUp"></p>
<p>Remember, we are not trying to read opcodes here, just flowing with things that make sense according to the names that we know. There are more orthodox ways to achieve this but we are investing less than five minutes, just an educated guess.</p>
<p>Take a look at the names below. To me, the first one makes sense CHTMLAnchorElement::Trampoline_Get_mimeType. True that the “Trampoline” part does not look familiar, but it does not prevent us to keep going and see if we find what we need.</p>
<p><img src="/images/2016/09/08-reference-03.png" alt="Code Step 1"></p>
<p>Entering there (double click) takes us to a longer piece of code, but we shouldn’t lose our target: mimeType. Don’t read opcodes, just find “mimeType”.</p>
<p><img src="/images/2016/09/08-reference-04.png" alt="CloseToMimeType"></p>
<p>Even if confusing at first sight, if we do as we said and ignore the opcodes, it’s obvious what’s the function that we should follow, right? And if we double click on CAnchorElement::get_mimeType, we will end up in the code below.</p>
<p><img src="/images/2016/09/08-reference-05.png" alt="Real call to code"></p>
<p>Again a bit longer than we would like, but we have CHyperlink_get_href first and a few lines below GetFileTypeInfo. It somewhat rings to me. First getting the href and then calling GetFileTypeInfo. I totally know this is a speculation but when we are analyzing regular code, educated guesses work most of the time. If we were reversing malware this would be harder, however, IE does not play tricks on us. Let’s go to GetFileTypeInfo and see what we have there.</p>
<p><img src="/images/2016/09/08-reference-06.png" alt="GetFileTypeInfo"></p>
<p>We found our code! The call to <a href="https://learn.microsoft.com/en-us/windows/win32/api/shellapi/nf-shellapi-shgetfileinfow">SHGetFileInfoW</a> looks obvious. This seems to be the code that retrieves the mimeType, but remember we are speculating here. Let’s see if this 3 minute speculation gives us some dividends.</p>
<h3 id="finding-references-to-discover-alternative-paths">Finding References (to discover alternative paths)</h3>
<p>Click once at the top, over “GetFileTypeInfo” and press the “X” to display all references. Remember: we want to see if there are other ways to hit this code.</p>
<p><img src="/images/2016/09/references.png" alt="References that hit the code"></p>
<h3 id="trying-javascript-code">Trying JavaScript Code</h3>
<p>Bingo! It seems that this code is hit twice by <em>CDocument::get_mimeType</em>, another one by <em>CImgElement::get_mimeType</em> and of course the one that we knew from the beginning, <em>CAnchorElement::get_mimeType.</em> CDocument looks like the document object to me and CImgElement seems to be the Image object or IMG HTML Tag. Of course we are speculating, but what do we lose by going right now to the browser and testing document.mimeType and Image.mimeType? I didn’t even know (or remember) that those properties existed.</p>
<p><img src="/images/2016/09/try-js-gif.png" alt="Hitting the code using an Image"></p>
<p>Rayos y centellas, Batman! It worked! Let’s see what happens with the document object. Will this work?</p>
<p><img src="/images/2016/09/try-js-doc.png" alt="Hitting with document.mimeType"></p>
<p>So now that we learned about these properties, we can complete the original flow, just like this:</p>
<p><img src="/images/2016/09/flow2-1.png" alt=""></p>
<p>We still don’t know if the anchorElement has other paths to the same code, but why bother? We are working with the unpatched binary and as we’ve seen at the beginning, the patched one has been seriously trimmed. In fact, a quick analysis reveals that anchorElement.mimeType and GetFileTypeInfo are not connected anymore. By “quick analysis” I mean pressing the “X” over the GetFileTypeInfo function inside IDA on the patched file. So, the updated flow really looks like this:</p>
<p><img src="/images/2016/09/patched-1.png" alt=""></p>
<h3 id="playing-withcode-alternatives">Playing with Code Alternatives</h3>
<p>We know that the anchorElement is useless for our goal but the image and document objects have chances. Well, thinking for a moment, images can’t render things other than images, so it will be better to first try using the document object which is capable of rendering images, xml, html, and more. Also, if we are going to render different content-types in a document, better not to use the one where we run our script, right? If we do, our script will be unloaded by the new content. Let’s create an iframe and play with its document.</p>
<p>We try to render a .saz (Fiddler) file right inside the iframe.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">iframe </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> document</span><span style="color:var(--astro-code-token-function)">.createElement</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"iframe"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">iframe</span><span style="color:var(--astro-code-foreground)">.src </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)"> "saz.saz"</span><span style="color:var(--astro-code-foreground)">;  </span><span style="color:var(--astro-code-token-comment)">// Load a saz file</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-token-function)">.</span><span style="color:var(--astro-code-token-constant)">body</span><span style="color:var(--astro-code-token-function)">.appendChild</span><span style="color:var(--astro-code-foreground)">(iframe);</span></span></code></pre>
<p>Damn! IE tries to download the file and throws this warning!</p>
<p><img src="/images/2016/09/warning.png" alt="IE Warning"></p>
<p>Not acceptable. Attackers are very cautious with these things. They will get caught immediately with a code like that. And in any case, it does not work: when we try to get the document.mimeType of that iframe, it returns “Chrome HTML Document”. We need to change the URL of that iframe without warnings and fool IE to think that a saz file has been rendered. We will set the location of the iframe without really changing the content of the document. This can be done with <a href="https://developer.mozilla.org/en-US/docs/Web/API/History/pushState">history.pushState</a> or <a href="https://developer.mozilla.org/en-US/docs/Web/API/History/replaceState">history.replaceState</a>. Let’s continue with the same iframe.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-constant)">iframe</span><span style="color:var(--astro-code-token-function)">.</span><span style="color:var(--astro-code-token-constant)">contentWindow</span><span style="color:var(--astro-code-token-function)">.</span><span style="color:var(--astro-code-token-constant)">history</span><span style="color:var(--astro-code-token-function)">.pushState</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">""</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)">""</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)">"saz.saz"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-constant)">iframe</span><span style="color:var(--astro-code-foreground)">.</span><span style="color:var(--astro-code-token-constant)">contentDocument</span><span style="color:var(--astro-code-foreground)">.mimeType);</span></span></code></pre>
<p><img src="/images/2016/09/pushStateMimeType.png" alt="pushstatemimetype"></p>
<p>It seems that we have it, right? Wrong! We’ve been lucky because the saz file was previously downloaded and cached, although not rendered because it has a saz extension. When IE requests data from a URL, it first tries to guess its content type <a href="https://msdn.microsoft.com/library/ms775147.aspx">using different mechanisms</a>, and the last of them is the file extension. In this case we are not even retrieving a valid saz file, the web-server response was a default HTTP Status Code 200 with default Content-Type: application/octet-stream but IE ended up guessing that it’s a Fiddler file because of its extension, however, it needed to download the file first.</p>
<h3 id="building-a-working-proof-of-concept">Building a working Proof of Concept</h3>
<p>So what can we do to download the file in advance without warnings? Well, there are a zillion ways, but let’s use the most primitive one which was used in the past to cache roll-over images: the Image object. Let’s build a proof of concept but this time caching the saz in advance and using replaceState instead of pushState (it’s cleaner and doesn’t add URLs in the history object).</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">img </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-keyword)"> new</span><span style="color:var(--astro-code-token-function)"> Image</span><span style="color:var(--astro-code-foreground)">();</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">img</span><span style="color:var(--astro-code-foreground)">.src </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)"> "saz.saz"</span><span style="color:var(--astro-code-foreground)">; </span><span style="color:var(--astro-code-token-comment)">// HTTP 200, any length and content-type</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// The saz is precached. Let's create the iframe.</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">iframe </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> document</span><span style="color:var(--astro-code-token-function)">.createElement</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"iframe"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// Load anything inside it because about:blank does not work with replaceState.</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">iframe</span><span style="color:var(--astro-code-foreground)">.src </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)"> "/favicon.ico"</span><span style="color:var(--astro-code-foreground)">;</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-token-function)">.</span><span style="color:var(--astro-code-token-constant)">body</span><span style="color:var(--astro-code-token-function)">.appendChild</span><span style="color:var(--astro-code-foreground)">(iframe);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// Set the location of the iframe to the saz file</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">iframe</span><span style="color:var(--astro-code-token-function)">.</span><span style="color:var(--astro-code-token-constant)">contentWindow</span><span style="color:var(--astro-code-token-function)">.</span><span style="color:var(--astro-code-token-constant)">history</span><span style="color:var(--astro-code-token-function)">.replaceState</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">""</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> ""</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> img</span><span style="color:var(--astro-code-foreground)">.src);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// Bingo!</span></span>
<span class="line"><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-constant)">iframe</span><span style="color:var(--astro-code-foreground)">.</span><span style="color:var(--astro-code-token-constant)">contentDocument</span><span style="color:var(--astro-code-foreground)">.mimeType);</span></span></code></pre>
<p><a href="https://www.youtube.com/watch?v=rrcyzbP2xeI">Video</a>
<strong>Update</strong>: variation patched on 2016-11-08</p>
<p>Have a nice day, fellow bug hunter!
Questions? Ping me at <a href="https://twitter.com/magicmac2000">magicmac2000</a>.</p> <div class="pagination"> <div class="pagination__title"> <span class="pagination__title-h">Read other posts</span> <hr> </div> <div class="pagination__buttons">  <a href="/blog/referer-spoofing-defeating-xss-filter/" class="button inline prev">
&lt; [Referer spoofing and defeating the XSS filter (Edge/IE)]
</a> <span>::</span> <a href="/blog/workers-sop-bypass-importscripts-and-basehref/" class="button inline next">
[Workers SOP Bypass importScripts and baseHref (Edge/IE)] &gt;
</a> </div> </div>  </div> </article> <script type="module">document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("pre.astro-code").forEach(t=>{const n=document.createElement("div");n.className="highlight",t.parentNode?.insertBefore(n,t),n.appendChild(t);const a=t.getAttribute("data-language")||"text",o=document.createElement("div");if(o.className="code-title",o.textContent=a,navigator.clipboard){const e=document.createElement("button");e.className="copy-button",e.textContent="Copy",e.addEventListener("click",async()=>{const c=t.textContent||"";try{await navigator.clipboard.writeText(c),e.textContent="Copied",setTimeout(()=>{e.textContent="Copy"},1e3)}catch(r){console.error("Failed to copy:",r)}}),o.appendChild(e)}n.insertBefore(o,t)})});</script>  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>  </main> <footer class="footer"> <div class="footer__inner"> <div class="copyright"> <span>© 2026 MagicMac Labs</span> </div> </div> </footer> </div> <script type="module">(()=>{const s=document.querySelector(".container"),o=document.querySelectorAll(".menu");document.body.addEventListener("click",()=>{o.forEach(e=>{e.classList.contains("open")&&e.classList.remove("open")})}),window.addEventListener("resize",()=>{o.forEach(e=>{e.classList.remove("open")})}),o.forEach(e=>{const i=e.querySelector(".menu__trigger"),t=e.querySelector(".menu__dropdown");i&&t&&(i.addEventListener("click",n=>{n.stopPropagation(),e.classList.contains("open")?e.classList.remove("open"):(o.forEach(c=>c.classList.remove("open")),e.classList.add("open")),s&&t.getBoundingClientRect().right>s.getBoundingClientRect().right&&(t.style.left="auto",t.style.right="0")}),t.addEventListener("click",n=>n.stopPropagation()))})})();</script> </body> </html> 