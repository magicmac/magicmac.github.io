<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="alternate icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.16.6"><title>Detecting Installed Extensions (Edge)</title><meta name="description" content><link rel="canonical" href="https://www.brokenbrowser.com/blog/microsoft-edge-detecting-installed-extensions/"><meta property="og:title" content="Detecting Installed Extensions (Edge)"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://www.brokenbrowser.com/blog/microsoft-edge-detecting-installed-extensions/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Detecting Installed Extensions (Edge)"><meta name="twitter:description" content><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><link rel="stylesheet" href="/_astro/_slug_.D8CnJWvD.css"></head> <body> <div class="container center"> <header class="header"> <div class="header__inner"> <div class="header__logo"> <a href="/"> <div class="logo">
MagicMac Labs
</div> </a> </div> <ul class="menu menu--mobile"> <li class="menu__trigger">Menu ▾</li> <li> <ul class="menu__dropdown"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </li> </ul> </div> <nav class="navigation-menu"> <ul class="navigation-menu__inner menu--desktop"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </nav> </header> <main class="content">  <article> <h1 class="post-title">Detecting Installed Extensions (Edge)</h1> <div class="post-meta"> <time> <time datetime="2017-04-06T00:00:00.000Z"> 2017-04-06 </time> </time> <span class="post-category"> :: browser-workshop</span>  </div>  <div class="post-content">  <p>Attackers love being able to fingerprint their victims. We’ve seen in the past two techniques that allowed the bad guys to <a href="../detecting-local-files-to-evade-analysts/">detect the presence of particular files (to evade analysts)</a> and even <a href="../detecting-apps-mimetype-malware/">get the application names associated to specific mimeTypes</a>. Microsoft patched those ones and <a href="https://twitter.com/magicmac2000/status/790614692364517376">other variations</a> but today we are going to see how to detect browser extensions installed on Edge.</p>
<p>Yesterday, <a href="https://twitter.com/nataliabielova/status/849629018756444160">Nataliia Bielova tweeted</a> about a <a href="https://extensions.inrialpes.fr/">site that shows how extensions can be detected</a> on different browsers, however, Microsoft Edge is excluded.</p>
<p><img src="/images/2017/04/01-edge-excluded.png" alt=""></p>
<p>By the way, terrific research and proof of concept from <a href="https://twitter.com/PrivaticsInria">Inria Privatics</a>, <a href="https://twitter.com/GulyasGG">Gábor Gulyás</a>, and <a href="https://twitter.com/nataliabielova">Nataliia Bielova</a>.</p>
<p>If you want to learn more about how to detect extensions on Firefox and Chrome, <a href="http://www.cse.chalmers.se/research/group/security/publications/2017/extensions/codaspy-17.pdf">read this paper</a> which describes their methodology, but here we will try to achieve the same thing on Microsoft Edge.</p>
<h2 id="installing-an-extension">Installing an Extension</h2>
<p>In the <a href="https://www.microsoft.com/en-us/store/collections/edgeextensions/pc">extensions store</a> I randomly selected the <a href="https://www.microsoft.com/en-us/store/p/adguard-adblocker/9mz607gwkbs7">AdGuard blocker</a>. After two clicks it was installed and automatically opened a thank-you page that gave me ideas before even starting the research. Check it out.</p>
<p><img src="/images/2017/04/02-thank-you.png" alt=""></p>
<p>That URL is all we need to get started. If we can load it in an iframe and detect its presence (onload/onreadystatechange/whatever) to distinguish it between a default Edge 404 page, we are almost done. But unfortunately iframes refuse to load the <em>ms-browser-extension:</em> protocol.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="html"><code><span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-token-function)"> src</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"ms-browser-extension://EdgeExtension_AdguardAdguardAdBlocker_m055xr0c82818/pages/thankyou.html"</span><span style="color:var(--astro-code-foreground)">>&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-foreground)">></span></span></code></pre>
<p><img src="/images/2017/04/03-iframe-fails.png" alt=""></p>
<p>OK. What about window.open? Can we at least open those URLs from a script? Let’s try!</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">win </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> window</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"ms-browser-extension://EdgeExtension_AdguardAdguardAdBlocker_m055xr0c82818/pages/thankyou.html"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// returns null when the URL is ms-browser-extension: (not useful for us)</span></span>
<span class="line"></span></code></pre>
<p><img src="/images/2017/04/04-open-null.png" alt=""></p>
<p>It opens! But, it is not really useful for us because the window.open() returns null instead of a window object, with or without the installed extension. In other words, when we try to open a new window using the extension-protocol <em>ms-browser-extension:</em> it will <strong>always</strong> return null. So even if we can actually open the window (which by the way is an ugly solution), we have no way to check if the content was loaded.</p>
<p>What about images from the extensions? Maybe images are exposed to the main page and using the onload/onerror events we can detect if the extension is installed. Let’s first find out where the extension files are located in our file-system.</p>
<h2 id="locating-the-extension-files">Locating the Extension Files</h2>
<p>Fire up <a href="https://technet.microsoft.com/en-us/sysinternals/processmonitor">Process Monitor</a> and include MicrosoftEdgeCP.exe in the filters. Close Edge and load the thank-you page from AdGuard by simply pasting the URL into Edge address bar. Bang! We can immediately see in Process Monitor where the files are located. Remember, our goal is to find an image from this extension to see if we can load it and detect its presence via onload/onerror.</p>
<p><img src="/images/2017/04/05-procmon.png" alt=""></p>
<p>It seems that the extension files are located here:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>C:\Program Files\WindowsApps\Adguard.AdguardAdBlocker_2.5.18.0_neutral__m055xr0c82818\Extension\Pages</span></span></code></pre>
<p>Going to the previous (parent) folder, we can see that just like in Chrome and Firefox, there’s a manifest.json which allows a few resources to be loaded by any website.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>"web_accessible_resources": [</span></span>
<span class="line"><span>   "elemhidehit.png", </span></span>
<span class="line"><span>   "lib/content-script/assistant/css/assistant.css", </span></span>
<span class="line"><span>   "lib/content-script/assistant/i/close.svg", </span></span>
<span class="line"><span>   "lib/content-script/assistant/i/logo.svg", // Let's use this one!</span></span>
<span class="line"><span>   "lib/content-script/assistant/i/logo-white.svg"</span></span>
<span class="line"><span>]</span></span></code></pre>
<p>Many of them are images, let’s try to load <code>logo.svg</code> with a quick script. If onload fires the extension is installed, otherwise it means the user does not have it.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-keyword)">var</span><span style="color:var(--astro-code-foreground)"> img </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-keyword)"> new</span><span style="color:var(--astro-code-token-function)"> Image</span><span style="color:var(--astro-code-foreground)">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">img</span><span style="color:var(--astro-code-foreground)">.</span><span style="color:var(--astro-code-token-function)">onload</span><span style="color:var(--astro-code-token-keyword)"> =</span><span style="color:var(--astro-code-token-keyword)"> function</span><span style="color:var(--astro-code-foreground)">(){</span><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"Extension Detected"</span><span style="color:var(--astro-code-foreground)">)}</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">img</span><span style="color:var(--astro-code-foreground)">.</span><span style="color:var(--astro-code-token-function)">onerror</span><span style="color:var(--astro-code-token-keyword)"> =</span><span style="color:var(--astro-code-token-keyword)"> function</span><span style="color:var(--astro-code-foreground)">(){</span><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"Extension NOT Detected"</span><span style="color:var(--astro-code-foreground)">)}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">img</span><span style="color:var(--astro-code-foreground)">.src </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)"> "ms-browser-extension://EdgeExtension_AdguardAdguardAdBlocker_m055xr0c82818/lib/content-script/assistant/i/logo.svg"</span><span style="color:var(--astro-code-foreground)">;</span></span></code></pre>
<p><img src="/images/2017/04/06-adguard-detected.png" alt=""></p>
<p>This does not impress me, at all. We are essentially doing nothing new and just like the other detection methods (for Chrome/FF), we depend on the extension cooperation to allow resources to be loaded. If there is an extension that does not have the <strong>web accessible resources</strong> in the manifest, how will we detect it?</p>
<h2 id="a-generic-way-to-detect-extensions">A Generic Way to Detect Extensions</h2>
<blockquote>
<p>Update 2017-04-11: the following technique crashes badly after Windows Creators Update, however, there are at least two variations that work. One of them will be posted soon. Thanks for your patience!</p>
</blockquote>
<p>After playing around a few minutes with different tricks and trying to load non-accessible-resources, I decided to try something similar to <a href="https://twitter.com/irsdl">Soroush’s</a> <a href="https://soroush.me/blog/microsoft-xmldom-in-ie-can-divulge-information-of-local-drivenetwork-in-error-messages">IE DTD trick</a>. which tries to load a resource using the Microsoft XMLDOM object, and depending on the error number it will know if the file was present or not. On Edge we don’t have the XMLDOM object but we can do something similar with the regular XMLHttpRequest.</p>
<p>If try to open a resource and the extension exists it throws an access denied, otherwise an unspecified error. In fact, to honour Soroush amazing finding we will try to be as elegant as him and use the error number received in the catch. A block of code is worth a thousand words. Take a look below:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-keyword)">var</span><span style="color:var(--astro-code-foreground)"> extension </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)"> "ms-browser-extension://EdgeExtension_AdguardAdguardAdBlocker_m055xr0c82818"</span><span style="color:var(--astro-code-foreground)">;</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">try</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">{</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">     var</span><span style="color:var(--astro-code-foreground)"> xhr </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-keyword)"> new</span><span style="color:var(--astro-code-token-function)"> XMLHttpRequest</span><span style="color:var(--astro-code-foreground)">();</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">     xhr</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"GET"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-foreground)"> extension</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> false</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">     xhr</span><span style="color:var(--astro-code-token-function)">.send</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-constant)">null</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">}</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">catch</span><span style="color:var(--astro-code-foreground)">(e)</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">{</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">     if</span><span style="color:var(--astro-code-foreground)"> (</span><span style="color:var(--astro-code-token-constant)">e</span><span style="color:var(--astro-code-foreground)">.number </span><span style="color:var(--astro-code-token-keyword)">==</span><span style="color:var(--astro-code-token-keyword)"> -</span><span style="color:var(--astro-code-token-constant)">2147024891</span><span style="color:var(--astro-code-foreground)">) </span><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"Exists"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">     else</span><span style="color:var(--astro-code-token-function)"> alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"Does not exist"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">}</span></span>
<span class="line"></span></code></pre>
<p><img src="/images/2017/04/07-adguard-detected-generic.png" alt=""></p>
<p>Now this is looking good, thanks <a href="https://twitter.com/irsdl">Soroush</a> for all your brilliant ideas!</p>
<p>By the way, have you noted that the URL that we are using is not even pointing to a specific resource? The xml trick works against the directory name and it does not even need to point to a specific resource of the extension, so now, having the extension ID is enough to detect it. If we want to build a generic tester to find all installed extensions like the one we’ve seen for Chrome and Firefox, we need to first install all the extensions in our Edge and take note of their IDs. It’s easy, just install the extension, load a blank page and press F12. That enough to reveal the extension ID. I’ve installed a few of them so it becomes clearer in the screenshot below.</p>
<p><img src="/images/2017/04/08-extension-ids.png" alt=""></p>
<p>With those names we can now create a generic extension detector for Microsoft Edge. Only disabled extensions won’t be loaded in Developer Tools but we can still find them in the registry:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>HKEY_CLASSES_ROOT\Local Settings\Software\Microsoft\Windows\CurrentVersion\AppContainer\Storage\microsoft.microsoftedge_8wekyb3d8bbwe\MicrosoftEdge\Extensions</span></span></code></pre>
<p>Worth noting is that our detection method will work <strong>even if the user has disabled the extensions</strong>. Below is the PoC that detects 20 extensions using the method described above.</p>
<p><img src="/images/2017/04/09-installed-extensions-poc.png" alt=""></p>
<blockquote>
<p>Update 2017-04-11: the following technique crashes badly after Windows Creators Update, however, there are at least two variations that work. One of them will be posted soon. Thanks for your patience!</p>
</blockquote>
<p>Have a nice day! :)</p>
<p><a href="https://twitter.com/magicmac2000">Manuel</a></p> <div class="pagination"> <div class="pagination__title"> <span class="pagination__title-h">Read other posts</span> <hr> </div> <div class="pagination__buttons">  <a href="/blog/free-ticket-to-the-intranet-zone/" class="button inline prev">
&lt; [Defeating the popUp blocker, the XSS filter and SuperNavigate with our fake ticket to the Intranet Zone (Edge)]
</a> <span>::</span> <a href="/blog/sop-bypass-abusing-read-protocol/" class="button inline next">
[SOP bypass courtesy of the reading mode (Edge)] &gt;
</a> </div> </div>  </div> </article> <script type="module">document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("pre.astro-code").forEach(t=>{const n=document.createElement("div");n.className="highlight",t.parentNode?.insertBefore(n,t),n.appendChild(t);const a=t.getAttribute("data-language")||"text",o=document.createElement("div");if(o.className="code-title",o.textContent=a,navigator.clipboard){const e=document.createElement("button");e.className="copy-button",e.textContent="Copy",e.addEventListener("click",async()=>{const c=t.textContent||"";try{await navigator.clipboard.writeText(c),e.textContent="Copied",setTimeout(()=>{e.textContent="Copy"},1e3)}catch(r){console.error("Failed to copy:",r)}}),o.appendChild(e)}n.insertBefore(o,t)})});</script>  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>  </main> <footer class="footer"> <div class="footer__inner"> <div class="copyright"> <span>© 2026 MagicMac Labs</span> </div> </div> </footer> </div> <script type="module">(()=>{const s=document.querySelector(".container"),o=document.querySelectorAll(".menu");document.body.addEventListener("click",()=>{o.forEach(e=>{e.classList.contains("open")&&e.classList.remove("open")})}),window.addEventListener("resize",()=>{o.forEach(e=>{e.classList.remove("open")})}),o.forEach(e=>{const i=e.querySelector(".menu__trigger"),t=e.querySelector(".menu__dropdown");i&&t&&(i.addEventListener("click",n=>{n.stopPropagation(),e.classList.contains("open")?e.classList.remove("open"):(o.forEach(c=>c.classList.remove("open")),e.classList.add("open")),s&&t.getBoundingClientRect().right>s.getBoundingClientRect().right&&(t.style.left="auto",t.style.right="0")}),t.addEventListener("click",n=>n.stopPropagation()))})})();</script> </body> </html> 