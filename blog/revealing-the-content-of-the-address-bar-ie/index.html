<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="alternate icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.16.6"><title>Revealing the content of the address bar (IE)</title><meta name="description" content><link rel="canonical" href="https://www.brokenbrowser.com/blog/revealing-the-content-of-the-address-bar-ie/"><meta property="og:title" content="Revealing the content of the address bar (IE)"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://www.brokenbrowser.com/blog/revealing-the-content-of-the-address-bar-ie/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Revealing the content of the address bar (IE)"><meta name="twitter:description" content><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><link rel="stylesheet" href="/_astro/_slug_.D8CnJWvD.css"></head> <body> <div class="container center"> <header class="header"> <div class="header__inner"> <div class="header__logo"> <a href="/"> <div class="logo">
MagicMac Labs
</div> </a> </div> <ul class="menu menu--mobile"> <li class="menu__trigger">Menu ▾</li> <li> <ul class="menu__dropdown"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </li> </ul> </div> <nav class="navigation-menu"> <ul class="navigation-menu__inner menu--desktop"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </nav> </header> <main class="content">  <article> <h1 class="post-title">Revealing the content of the address bar (IE)</h1> <div class="post-meta"> <time> <time datetime="2017-09-26T00:00:00.000Z"> 2017-09-26 </time> </time> <span class="post-category"> :: browser-workshop</span>  </div>  <div class="post-content">  <p>Hello fellow bug hunter! Today we are going back to Internet Explorer which despite getting old, tons people still use it. I am much happier with <a href="https://twitter.com/msftsecresponse">MSRC</a> lately, they are really moving forward regarding Edge, design bugs, and they even extended its <a href="https://blogs.technet.microsoft.com/msrc/2017/06/21/extending-the-microsoft-edge-bounty-program/">bug bounty, which seems to be permanent now</a>.</p>
<p>All those are good news, but I still believe it is not acceptable to leave IE wide open. For example, right now all IE users can be turned into bots with the <a href="../zombie-alert/">zombie script bug</a> (which has been public and unpatched for months). If you don’t think it’s important, then imagine what black hats can do right now: they can<a href="../zombie-alert/"> stay in your browser even if you navigate to a different site</a>, which gives them plenty of time to do ugly stuff like <a href="https://blog.malwarebytes.com/threat-analysis/2017/09/drive-by-mining-and-ads-the-wild-wild-west/">mining digital currencies while abusing of users CPUs</a>. Also, IE has its <a href="../free-ticket-to-the-intranet-zone/">popUp blocker is completely broken</a> and nobody seem to care. Fine, but I think these things should be patched or at least set a big red warning to IE users when they open it, something like “<em>We do not support this browser anymore, use Microsoft Edge</em>”.</p>
<p>In my opinion, Microsoft is trying to get rid of IE without saying it. It would be easier, more honest to simply tell users that their older browser is not being serviced like Edge. Current browser stats, according to <a href="https://www.netmarketshare.com/browser-market-share.aspx?qprid=0&#x26;qpcustomd=0&#x26;qpcustomb=&#x26;qpsp=2017&#x26;qpnp=1&#x26;qptimeframe=Y">Netmarketshare</a> show that IE is still more popular than Edge: 17% vs 6%.</p>
<p>I firmly believe that IE should be treated like Edge in terms of security, otherwise get rid of it completely. Either way, let’s explore another bug on IE that allows attackers to know the address where the user is going. Mind reading? Nope, we know mind reading does not exist, but take a look and see how IE allows us attackers to do what appears to be magic.</p>
<hr>
<h2 id="abstract">Abstract</h2>
<p>When a script is executed inside an object-html tag, the location object will get confused and return the main location instead of its own. To be precise, it will return the text written in the address bar so whatever the user types there will be accessible by the attacker. In a hurry? Take a look at the <a href="https://www.youtube.com/watch?v=xyzd7PLqAV8&#x26;list=PL12o0t84rBX_oDmz93NwGNgTDiWf-HfUY">video and watch how we read what the user types inside IE address-bar</a>!</p>
<h2 id="objects-and-document-modes">Objects and Document Modes</h2>
<p>Object tags behave differently depending on the documentMode where they are being rendered. For example, if we add the compatibility meta tag at the beginning of a page it will look and behave like an iframe but it will <strong>think it is the top window</strong>.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="html"><code><span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">head</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">  &#x3C;!-- COMPATIBILITY META TAG --></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">  &#x3C;</span><span style="color:var(--astro-code-token-string-expression)">meta</span><span style="color:var(--astro-code-token-function)"> http-equiv</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"X-UA-Compatible"</span><span style="color:var(--astro-code-token-function)"> content</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"IE=8"</span><span style="color:var(--astro-code-foreground)"> /></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">head</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">object</span><span style="color:var(--astro-code-token-function)"> data</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"obj.html"</span><span style="color:var(--astro-code-token-function)"> type</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"text/html"</span><span style="color:var(--astro-code-foreground)">>&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">object</span><span style="color:var(--astro-code-foreground)">></span></span></code></pre>
<p>In the code above, “obj.html” is rendered inside the object and the contents are wrapped inside a block similar to an iframe, however, comparing its window object with the top one returns true, when it shouldn’t: it is not the top window. Take a look at the code executed inside the object tag: it thinks <strong>window == top</strong>, which isn’t really true.</p>
<p><img src="/images/2017/06/02_docmode8.png" alt=""></p>
<p>Our object believes it’s the top window, to the point that other members like frameElement return always null, a behavior that only happens on top windows (on IE).</p>
<p>Let’s try the same code without the compatibility tag. It seems that the object now understands its place in the universe and behaves like an iframe.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="html"><code><span class="line"><span style="color:var(--astro-code-token-comment)">&#x3C;!-- COMPATIBILITY META TAG REMOVED --></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">object</span><span style="color:var(--astro-code-token-function)"> data</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"obj.html"</span><span style="color:var(--astro-code-token-function)"> type</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"text/html"</span><span style="color:var(--astro-code-foreground)">>&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">object</span><span style="color:var(--astro-code-foreground)">></span></span></code></pre>
<p><img src="/images/2017/06/03_docmode11.png" alt=""></p>
<p>Essentially, the object is being rendered as an independent entity in older document modes but as an iframe in newer ones. Regardless of that, internally both are <a href="https://msdn.microsoft.com/en-us/library/aa752040(v=vs.85).aspx">WebBrowser controls</a>, Trident engines exposing the same members.</p>
<h2 id="inheritedwindow-members">Inherited window members</h2>
<p>Let’s set back an older documentMode and find a way to exploit this confusion-bug which does not seem to be <em>that bad</em> because cross-domain restrictions are still in place, and the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options">X-FRAME-OPTIONS</a> header works perfectly well. There are members like <strong>window.name</strong> which are inherited by the object (the object inherits the name of its parent) but that’s not super-bad except for specific advertising technologies which insecurely use the window.name to pass information across iframes.</p>
<p>Having said that, there’s at least one inherited object that really causes trouble: <strong>location</strong>. Inside an object tag, location.href will return the location of the main (top) window. The code below renders the object with its source pointing to <strong>object_location.html</strong>, but when we retrieve its location it returns the top instead.</p>
<p><img src="/images/2017/06/04_location_confusion.png" alt=""></p>
<p>Again, this confusion-bug is not useful because we are still on the same domain. Even if we can retrieve -thanks to the confusion- the location of the top, as long as we are on the same domain things are not exciting. By the way bug hunter, I tried for a few minutes to change the location of the object, but no success. If you want to research on this area I would suggest going deeper because I believe it should be possible. Regardless of that, while trying to achieve a <strong>UXSS</strong> (persistence is key for everything in life) an interesting bug stumbled upon me: when the object is injected **onbeforeunload **what we get is not the top location anymore, but the location that the browser is going to or, what’s currently written into the address bar.</p>
<p>In other words, if we <strong>retrieve the location.href of the object while the user is leaving the main page, we will be able to know what was typed into the address-bar</strong>, or, if the user clicked on a link we will know the address of the link that the browser is going to.</p>
<p>For our testing purposes, we will just interrupt the loading of the new site and show the URL to the user. Of course, an attacker would simply post-back the address and load the site anyway making this transparent to the user. Let’s do a simple document.write of the object while the user is leaving.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-constant)">window</span><span style="color:var(--astro-code-foreground)">.</span><span style="color:var(--astro-code-token-function)">onbeforeunload</span><span style="color:var(--astro-code-token-keyword)"> =</span><span style="color:var(--astro-code-token-keyword)"> function</span><span style="color:var(--astro-code-foreground)">()</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">{</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">  document</span><span style="color:var(--astro-code-token-function)">.write</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">'&#x3C;object data="loc.html" type="text/html" width="800" height="300">&#x3C;/object>'</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">  document</span><span style="color:var(--astro-code-token-function)">.close</span><span style="color:var(--astro-code-foreground)">();</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">}</span></span></code></pre>
<p>And read the location at that precise moment (onbeforeunload).</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-token-function)">.write</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"Let me read your mind. You wanted to go here: "</span><span style="color:var(--astro-code-token-keyword)"> +</span><span style="color:var(--astro-code-token-constant)"> location</span><span style="color:var(--astro-code-foreground)">.href);</span></span></code></pre>
<p>That’s it! Now we will retrieve the object location when the user is leaving and know exactly what she typed into the address bar. It does not have to be a full URL, for example, if the user types words into the address bar, it will automatically be converted to a search query URL (Bing by default on IE) which can of course be completely read!</p>
<p><img src="/images/2017/09/address_bar_guess.png" alt=""></p>
<h3 id="watch-the-video">[ <a href="https://www.youtube.com/watch?v=xyzd7PLqAV8&#x26;list=PL12o0t84rBX_oDmz93NwGNgTDiWf-HfUY">Watch the Video</a> ]</h3>
<p>Have a nice day, and keep pushing into this object! I’m sure there are tons of things to be discovered.</p>
<p><a href="https://twitter.com/magicmac2000">Manuel</a>.</p> <div class="pagination"> <div class="pagination__title"> <span class="pagination__title-h">Read other posts</span> <hr> </div> <div class="pagination__buttons">  <a href="/blog/sop-bypass-uxss-stealing-credentials-pretty-fast/" class="button inline prev">
&lt; [SOP bypass / UXSS - Stealing Credentials Pretty Fast (Edge)]
</a>   </div> </div>  </div> </article> <script type="module">document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("pre.astro-code").forEach(t=>{const n=document.createElement("div");n.className="highlight",t.parentNode?.insertBefore(n,t),n.appendChild(t);const a=t.getAttribute("data-language")||"text",o=document.createElement("div");if(o.className="code-title",o.textContent=a,navigator.clipboard){const e=document.createElement("button");e.className="copy-button",e.textContent="Copy",e.addEventListener("click",async()=>{const c=t.textContent||"";try{await navigator.clipboard.writeText(c),e.textContent="Copied",setTimeout(()=>{e.textContent="Copy"},1e3)}catch(r){console.error("Failed to copy:",r)}}),o.appendChild(e)}n.insertBefore(o,t)})});</script>  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>  </main> <footer class="footer"> <div class="footer__inner"> <div class="copyright"> <span>© 2026 MagicMac Labs</span> </div> </div> </footer> </div> <script type="module">(()=>{const s=document.querySelector(".container"),o=document.querySelectorAll(".menu");document.body.addEventListener("click",()=>{o.forEach(e=>{e.classList.contains("open")&&e.classList.remove("open")})}),window.addEventListener("resize",()=>{o.forEach(e=>{e.classList.remove("open")})}),o.forEach(e=>{const i=e.querySelector(".menu__trigger"),t=e.querySelector(".menu__dropdown");i&&t&&(i.addEventListener("click",n=>{n.stopPropagation(),e.classList.contains("open")?e.classList.remove("open"):(o.forEach(c=>c.classList.remove("open")),e.classList.add("open")),s&&t.getBoundingClientRect().right>s.getBoundingClientRect().right&&(t.style.left="auto",t.style.right="0")}),t.addEventListener("click",n=>n.stopPropagation()))})})();</script> </body> </html> 