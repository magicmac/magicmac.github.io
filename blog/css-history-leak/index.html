<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="alternate icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.16.6"><title>CSS History Leak or &quot;I know where you&#39;ve been&quot; (Edge)</title><meta name="description" content><link rel="canonical" href="https://www.brokenbrowser.com/blog/css-history-leak/"><meta property="og:title" content="CSS History Leak or &#34;I know where you've been&#34; (Edge)"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://www.brokenbrowser.com/blog/css-history-leak/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="CSS History Leak or &#34;I know where you've been&#34; (Edge)"><meta name="twitter:description" content><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><link rel="stylesheet" href="/_astro/_slug_.D8CnJWvD.css"></head> <body> <div class="container center"> <header class="header"> <div class="header__inner"> <div class="header__logo"> <a href="/"> <div class="logo">
MagicMac Labs
</div> </a> </div> <ul class="menu menu--mobile"> <li class="menu__trigger">Menu ▾</li> <li> <ul class="menu__dropdown"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </li> </ul> </div> <nav class="navigation-menu"> <ul class="navigation-menu__inner menu--desktop"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </nav> </header> <main class="content">  <article> <h1 class="post-title">CSS History Leak or &quot;I know where you&#39;ve been&quot; (Edge)</h1> <div class="post-meta"> <time> <time datetime="2016-09-05T00:00:00.000Z"> 2016-09-05 </time> </time> <span class="post-category"> :: browser-workshop</span>  </div>  <div class="post-content">  <p>Hello fellow bug hunter!</p>
<p>I’ve been thinking this morning about <a href="https://blog.jeremiahgrossman.com/2006/08/i-know-where-youve-been.html">an old CSS trick</a>, where you could find out which sites were visited by the user. If you are not familiar with this one, I recommend you reading the <a href="https://blog.jeremiahgrossman.com/2006/08/i-know-where-youve-been.html">original post</a>. I will do my best to quickly explain, just in case. The following trick works on MS Edge, but I haven’t tried hard on other browsers.</p>
<p>Regular links have <em>by default</em> different colors depending if the user has visited them or not. For example, if we place here a link to <code>google.com</code> and another one to <code>bingadunga.com</code>, it’s likely that they will have different colors because you never visited this second site (a word that just came up to my mind) but for sure you’ve been in Google. An image will describe what I mean, much better than my words:</p>
<p><img src="/images/2016/09/visited1.png" alt="Visited vs Non Visited"></p>
<p>They have different colors because I’ve been in <code>google.com</code> but not in <code>bingadunga.com</code>. Easy and apparently harmless, correct? Let’s see.</p>
<p>Before the Cascading Style Sheets era you could control the color of the links using the <a href="https://developer.mozilla.org/en/docs/Web/HTML/Element/body"> attributes vlink, alink, and link</a>, but -as far as I remember- there was no way to <strong>get</strong> the current color via scripting. In other words, the user could see the difference between the visited/non-visited links but the attacker didn’t have a way to get that information.</p>
<p>The arrival of CSS gave browsers a lot of functionality which essentially replaced the old way to style pages. Developers could now have a clear separation between code/markup and style and one of the greatest features of CSS were the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Pseudo-classes">pseudo-classes</a>, which allowed dynamic changes of the style depending on user interaction like mouse over links, active elements, etc. For example, you could use <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:visited">:visited pseudo-class</a> which conveniently allowed you to set a different color to the links (<code>&#x3C;a></code> tags) that were previously visited. How nice! And this feature is still with us.</p>
<p>The big problem was that you could get the color of those links, via scripting! It allowed attackers to know if you’ve been on a site, depending on the color of the links. Essentially the attack goes like this: you render all the sites that you want to probe inside <code>&#x3C;a></code> tags, setting a <code>:visited</code> with a red color otherwise, blue. Then, by checking the colors of the links you know the red ones are the visited by the user.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-comment)">// Quick Pseudocode</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">function</span><span style="color:var(--astro-code-token-function)"> linkVisited</span><span style="color:var(--astro-code-foreground)">(linkElement)</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">{</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">   // Returns true when visited, false otherwise.</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">   return</span><span style="color:var(--astro-code-token-function)"> getComputedStyle</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-foreground)">.links[i]).color </span><span style="color:var(--astro-code-token-keyword)">==</span><span style="color:var(--astro-code-token-string-expression)"> "red"</span><span style="color:var(--astro-code-foreground)">;</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">}</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">for</span><span style="color:var(--astro-code-foreground)"> (</span><span style="color:var(--astro-code-token-keyword)">var</span><span style="color:var(--astro-code-foreground)"> i </span><span style="color:var(--astro-code-token-keyword)">in</span><span style="color:var(--astro-code-token-constant)"> document</span><span style="color:var(--astro-code-foreground)">.links)</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">{  </span><span style="color:var(--astro-code-token-comment)">// Go over links and alert the ones that were visited.</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">   if</span><span style="color:var(--astro-code-foreground)"> (</span><span style="color:var(--astro-code-token-function)">linkVisited</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-foreground)">.links[i]))</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">   {</span></span>
<span class="line"><span style="color:var(--astro-code-token-function)">      alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"Link visited:"</span><span style="color:var(--astro-code-token-keyword)"> +</span><span style="color:var(--astro-code-token-constant)"> document</span><span style="color:var(--astro-code-foreground)">.links[i]);</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">   }</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">}</span></span></code></pre>
<p>In any case, browsers had fixed the issue long ago. Today when requesting the color of a link, it always returns the original, non-visited one. So, it does not matter how much you ask via scripting, you will always get the same value anyway.</p>
<p>Different variations of this issue arrived using the most amazing techniques like timing, cache, and others. Browsers kept patching and fixing, but there’s always a way around it. And here’s what I found this morning: a simple variation that works on MS Edge. What I did was a simple check, having one link to bing.com and saving its CSS state, then changing that same link to bingadunga.com (a site that I never visited) and compared the new CSS state with the old one. In other words, quite simple. The pseudocode is something like this:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-comment)">// Quick Pseudocode</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">a</span><span style="color:var(--astro-code-token-function)"> href</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"http://www.bing.com"</span><span style="color:var(--astro-code-foreground)">>Bing&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">a</span><span style="color:var(--astro-code-foreground)">> (Visited link)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-foreground)">visitedCSS </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-function)"> getComputedStyle</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-foreground)">.links[</span><span style="color:var(--astro-code-token-constant)">0</span><span style="color:var(--astro-code-foreground)">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-foreground)">.links[</span><span style="color:var(--astro-code-token-constant)">0</span><span style="color:var(--astro-code-foreground)">].href </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)"> "http://www.bingadunga.com"</span><span style="color:var(--astro-code-foreground)">; </span><span style="color:var(--astro-code-token-comment)">// Not Visited.</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">notVisitedCSS </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-function)"> getComputedStyle</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-foreground)">.links[</span><span style="color:var(--astro-code-token-constant)">0</span><span style="color:var(--astro-code-foreground)">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// By comparing both cssTexts I stumbled upon a difference: webKitTextFillColor</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// How nice. Let's build an exploit!</span></span></code></pre>
<p>By finding a difference between both CSSs we got a new way to achieve the same trick thanks to <strong>webkitTextFillColor</strong>. So essentially, the only change from Jeremiahs original is the property “color” to “webkitTextFillColor”. Hard work on my part hehehe =)</p>
<p>Let’s see this in action in the video below.</p>
<p><strong>Update: this bug was silently patched on <a href="https://technet.microsoft.com/en-us/library/security/MS16-145">MS16-145</a>.</strong>
<a href="https://youtu.be/cMv4ODcg738">Video</a></p>
<p>Have a nice day, bug hunter! And remember: persistence and passion will bring you browser bugs (and even a great wife like the one I have!)</p> <div class="pagination"> <div class="pagination__title"> <span class="pagination__title-h">Read other posts</span> <hr> </div> <div class="pagination__buttons">  <a href="/blog/grabdatafrominput/" class="button inline prev">
&lt; [Grabbing data from Inputs and Textareas (Edge/IE)]
</a> <span>::</span> <a href="/blog/referer-spoofing-defeating-xss-filter/" class="button inline next">
[Referer spoofing and defeating the XSS filter (Edge/IE)] &gt;
</a> </div> </div>  </div> </article> <script type="module">document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("pre.astro-code").forEach(t=>{const n=document.createElement("div");n.className="highlight",t.parentNode?.insertBefore(n,t),n.appendChild(t);const a=t.getAttribute("data-language")||"text",o=document.createElement("div");if(o.className="code-title",o.textContent=a,navigator.clipboard){const e=document.createElement("button");e.className="copy-button",e.textContent="Copy",e.addEventListener("click",async()=>{const c=t.textContent||"";try{await navigator.clipboard.writeText(c),e.textContent="Copied",setTimeout(()=>{e.textContent="Copy"},1e3)}catch(r){console.error("Failed to copy:",r)}}),o.appendChild(e)}n.insertBefore(o,t)})});</script>  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>  </main> <footer class="footer"> <div class="footer__inner"> <div class="copyright"> <span>© 2026 MagicMac Labs</span> </div> </div> </footer> </div> <script type="module">(()=>{const s=document.querySelector(".container"),o=document.querySelectorAll(".menu");document.body.addEventListener("click",()=>{o.forEach(e=>{e.classList.contains("open")&&e.classList.remove("open")})}),window.addEventListener("resize",()=>{o.forEach(e=>{e.classList.remove("open")})}),o.forEach(e=>{const i=e.querySelector(".menu__trigger"),t=e.querySelector(".menu__dropdown");i&&t&&(i.addEventListener("click",n=>{n.stopPropagation(),e.classList.contains("open")?e.classList.remove("open"):(o.forEach(c=>c.classList.remove("open")),e.classList.add("open")),s&&t.getBoundingClientRect().right>s.getBoundingClientRect().right&&(t.style.left="auto",t.style.right="0")}),t.addEventListener("click",n=>n.stopPropagation()))})})();</script> </body> </html> 