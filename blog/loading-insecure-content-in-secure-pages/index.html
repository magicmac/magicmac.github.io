<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="alternate icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.16.6"><title>Bypassing Mixed Content Warnings - Loading Insecure Content in Secure Pages (Edge/IE)</title><meta name="description" content><link rel="canonical" href="https://www.brokenbrowser.com/blog/loading-insecure-content-in-secure-pages/"><meta property="og:title" content="Bypassing Mixed Content Warnings - Loading Insecure Content in Secure Pages (Edge/IE)"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://www.brokenbrowser.com/blog/loading-insecure-content-in-secure-pages/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Bypassing Mixed Content Warnings - Loading Insecure Content in Secure Pages (Edge/IE)"><meta name="twitter:description" content><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><link rel="stylesheet" href="/_astro/_slug_.D8CnJWvD.css"></head> <body> <div class="container center"> <header class="header"> <div class="header__inner"> <div class="header__logo"> <a href="/"> <div class="logo">
MagicMac Labs
</div> </a> </div> <ul class="menu menu--mobile"> <li class="menu__trigger">Menu ▾</li> <li> <ul class="menu__dropdown"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </li> </ul> </div> <nav class="navigation-menu"> <ul class="navigation-menu__inner menu--desktop"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </nav> </header> <main class="content">  <article> <h1 class="post-title">Bypassing Mixed Content Warnings - Loading Insecure Content in Secure Pages (Edge/IE)</h1> <div class="post-meta"> <time> <time datetime="2016-11-15T00:00:00.000Z"> 2016-11-15 </time> </time> <span class="post-category"> :: browser-workshop</span>  </div>  <div class="post-content">  <p>There are no doubts that the web is moving forward to HTTPS (secure) content. Most important names have today their certificates ready and their websites are in effect, secure. But have you ever wandered: secure to what extent? It’s clear that content served through HTTPS is protected from man in the middle (MITM) attacks, network sniffing/tampering and more. But, have you ever thought if the HTTPS protocol is protecting end users from something else? The answer is a clear YES.</p>
<p>As we know, attackers today deliver their malicious payloads using a wide range of channels and one of them is malvertising. They buy cheap ad-space to apparently advertise something, but deep inside those banners we can find obfuscated malware code. In fact, we’ve seen in the past how the bad guys were going as far as <a href="../detecting-local-files-to-evade-analysts/">detecting if the user was a potential victim or if she’s was an analyst</a>. If the human behind the keyboard was an unsavvy user attackers delivered the full malicious payload, otherwise they simply passed, masquerading themselves as innocent advertisers of a product.</p>
<h2 id="mixed-content-warning">Mixed Content Warning</h2>
<p>Attackers have a problem these days because some of their tricks work only in insecure pages, and browsers by default do not render insecure content from secure sites. To be concrete, if attackers are forced to load their code via HTTPS, many of their tricks (like detecting files in your file-system) will fail. Consider this: modern browsers refuse to load insecure content (HTTP) from secure locations (HTTPS). This is called sometimes “Mixed Content”.</p>
<p>If we are navigating an HTTPS page, browsers will not load insecure content (for example, an HTTP iframe with a banner inside). Internet Explorer will warn the user with the option to “Show all content” (which reloads the main page and shows the mixed content).</p>
<p><img src="/images/2016/11/01-only-secure-content.png" alt="01-only-secure-content"></p>
<p>Edge also blocks the content but shows no warnings unless the user has devtools-console in view. On the other hand, if the source of an iframe is insecure, a confusing error message is rendered instead of the HTTP content.</p>
<p><img src="/images/2016/11/02-that-didnt-work.png" alt=""></p>
<h2 id="images-are-allowed">Images are allowed</h2>
<p>An interesting exception is the fact that all browsers let <em>insecure images</em> load and render without restrictions. In other words, if attackers are already sniffing inside a network they will be able to view and replace images on the fly, but this does not seem to represent a real threat to final users. There’s a <a href="https://blogs.msdn.microsoft.com/ie/2011/06/23/internet-explorer-9-security-part-4-protecting-consumers-from-malicious-mixed-content/">very clear blog-post</a> written years ago by <a href="https://twitter.com/ericlaw">Eric Lawrence (aka: Internet Hero)</a> explaining why the IE team allowed to load insecure images without warnings. It makes sense: tons of sites were loading their images from external places using the HTTP protocol or even worse, they had hard-coded in their sources the HTTP protocol pointing to local images, but the main content itself (html/scripts) was secure. So, they decided to allow image tags to render with no warnings <em>except</em> the little padlock at the right of the address bar, which disappears when insecure content is loaded.</p>
<p>This is how the address bar looks before and after loading insecure images on IE. Note that the secure protocol of the main address bar does not change at all. I’ve circled the padlock in red so it’s easier to see.</p>
<p><img src="/images/2016/11/03-before-after-padlock.png" alt="03-before-after-padlock"></p>
<p>The same thing happens on Microsoft Edge but the padlock is on the left.</p>
<p>An interesting fact to keep in mind is that both browsers consider pseudo-protocols (res: mhtml: file:) insecure, and so we won’t be able to load them (like regular http inside https).</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="html"><code><span class="line"><span style="color:var(--astro-code-foreground)">These iframes won't render anything if the main page is secure/https</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-token-function)"> src</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"http://"</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-token-function)"> src</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"res://"</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-token-function)"> src</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"file://"</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-token-function)"> src</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"mhtml://"</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-token-function)"> src</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"mhtml:res://"</span><span style="color:var(--astro-code-foreground)">></span></span></code></pre>
<h2 id="behavior-with-pseudo-protocols">Behavior with Pseudo-Protocols</h2>
<p>You might be thinking, what do HTTPS has to do with these strange mhml: and res: protocols? Well, those strange protocols are used by attackers to load content from your hard-disk and detect the presence of local files, but if the main page is secure, they will have a big problem: IE will refuse to render those protocols and thus, avoid running their tricks! Think about it for a moment: secure pages are not only helping us to be protected from MITM attacks, but as a side effect are preventing attackers to execute many of their tricks.</p>
<p>Remember: when attackers want to check if the user has a particular file in her file-system, they tend to use well known techniques that abuse of the mhtml/res/file protocols. If you’ve never seen this before, <a href="../detecting-local-files-to-evade-analysts/">check out this post</a>, but the main point here is simple: <strong>modern browsers do not allow “mixed content” by default</strong>, and many of those tricks will fail in HTTPS.</p>
<h2 id="forcing-the-content-to-be-loaded">Forcing the Content to be Loaded</h2>
<p>Now that we are clear on attacker’s intentions, it’s time to step in their feet and (try to) bypass these warnings. Knowing in advance that there’s an exception to the rule (image tags) that renders content without user interaction, I tried to load an image as the source of an IFRAME (instead of using an IMG) but had no success. Then a bit of playing with the EMBED and OBJECT elements (both can render html) without real success. Finally, I tried with a regular IFRAME but <strong>setting its location using a server redirect</strong> instead of the insecure URL directly. That seemed to work, the content was finally loaded.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="html"><code><span class="line"><span style="color:var(--astro-code-foreground)">Main page should be secure/https</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-foreground)">The iframe below renders an insecure (http) bing.com</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-token-function)"> src</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"https://www.cracking.com.ar/redir/redir.php?URL=http://www.bing.com"</span><span style="color:var(--astro-code-foreground)">></span></span></code></pre>
<p><img src="/images/2016/11/05-load-with-warnings.png" alt="05-load-with-warnings"></p>
<p>As a researcher this finding seems interesting, but not useful from an attacker point of view. We’ve been able to load mixed content without user interaction, but we still have a warning which obviously calls the attention. The warning shows a wrong message because <strong>insecure content is displayed</strong> (bing.com has really been loaded as http), however, attackers will never use something that warns the user like that.</p>
<p>The problem happens when the insecure bing.com tries to render yet another insecure iframe inside. In other words, nested iframes need to be secure even inside insecure parent iframes. Of course we can again load the content using a redirection but that’s not helpful in real life because attackers need to load the IE pseudo-protocols (mhtml: res: and file:) and IE does not accept server redirects to those ones. We need a better alternative.</p>
<h2 id="bypassing-the-warning-messages">Bypassing the Warning Messages</h2>
<p>To bypass the warning message, the solution stumbled upon me. I was really surprised that something so basic made the trick: a document.write in the insecure iframe was enough. Can it be that simple?</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="html"><code><span class="line"><span style="color:var(--astro-code-foreground)">Main page should be secure/https</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-foreground)">The iframe below renders an insecure (http) page which does a document.write</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-token-function)"> src</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"https://www.cracking.com.ar/redir/redir.php?URL=http://unsafe.cracking.com.ar"</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-foreground)">The HTML code in the iframe is quite simple:</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">script</span><span style="color:var(--astro-code-foreground)">></span><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-token-function)">.write</span><span style="color:var(--astro-code-foreground)">()&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">script</span><span style="color:var(--astro-code-foreground)">></span></span></code></pre>
<p>Once we’ve loaded the insecure content and document.written inside, the iframe is free to load insecure content without the need of redirects. In other words, at this point attackers can load mhtml/res protocols and do their tricks without restrictions: IE has no idea that this content is being rendered and every nested iframe will be loaded without glitches.</p>
<p><img src="/images/2016/11/06-load-without-warnings.png" alt=""></p>
<p>Edge is vulnerable to the redirection trick, but the document.write one does not work.</p>
<p>Have a nice day!</p>
<p><a href="https://twitter.com/magicmac2000">@magicmac2000</a></p> <div class="pagination"> <div class="pagination__title"> <span class="pagination__title-h">Read other posts</span> <hr> </div> <div class="pagination__buttons">  <a href="/blog/detecting-local-files-to-evade-analysts/" class="button inline prev">
&lt; [Detecting Local Files to Evade Analysts (IE)]
</a> <span>::</span> <a href="/blog/abusing-of-protocols/" class="button inline next">
[Abusing of Protocols to Load Local Files, bypass the HTML5 Sandbox and Open Popups (Edge)] &gt;
</a> </div> </div>  </div> </article> <script type="module">document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("pre.astro-code").forEach(t=>{const n=document.createElement("div");n.className="highlight",t.parentNode?.insertBefore(n,t),n.appendChild(t);const a=t.getAttribute("data-language")||"text",o=document.createElement("div");if(o.className="code-title",o.textContent=a,navigator.clipboard){const e=document.createElement("button");e.className="copy-button",e.textContent="Copy",e.addEventListener("click",async()=>{const c=t.textContent||"";try{await navigator.clipboard.writeText(c),e.textContent="Copied",setTimeout(()=>{e.textContent="Copy"},1e3)}catch(r){console.error("Failed to copy:",r)}}),o.appendChild(e)}n.insertBefore(o,t)})});</script>  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>  </main> <footer class="footer"> <div class="footer__inner"> <div class="copyright"> <span>© 2026 MagicMac Labs</span> </div> </div> </footer> </div> <script type="module">(()=>{const s=document.querySelector(".container"),o=document.querySelectorAll(".menu");document.body.addEventListener("click",()=>{o.forEach(e=>{e.classList.contains("open")&&e.classList.remove("open")})}),window.addEventListener("resize",()=>{o.forEach(e=>{e.classList.remove("open")})}),o.forEach(e=>{const i=e.querySelector(".menu__trigger"),t=e.querySelector(".menu__dropdown");i&&t&&(i.addEventListener("click",n=>{n.stopPropagation(),e.classList.contains("open")?e.classList.remove("open"):(o.forEach(c=>c.classList.remove("open")),e.classList.add("open")),s&&t.getBoundingClientRect().right>s.getBoundingClientRect().right&&(t.style.left="auto",t.style.right="0")}),t.addEventListener("click",n=>n.stopPropagation()))})})();</script> </body> </html> 